<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Desktop</title>
    <style>
        /* Design System */
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-slate-500-rgb: 98, 108, 113;
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-family-mono: "Courier New", monospace;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-base: 8px;
            --radius-lg: 12px;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: #f5ede0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(232, 180, 208, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(168, 213, 186, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(184, 212, 232, 0.1) 0%, transparent 70%);
            height: 100vh;
            overflow: hidden;
            color: #2c2c2c;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 20px;
            right: 30px;
            width: 80px;
            height: 80px;
            background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Cpath d="M50 10 Q60 30 80 40 T90 70 Q80 85 50 90 T10 70 Q5 50 10 30 T50 10" fill="none" stroke="%23a8d5ba" stroke-width="2" opacity="0.3"/%3E%3Ccircle cx="50" cy="50" r="5" fill="%23e8b4d0" opacity="0.4"/%3E%3C/svg%3E');
            background-size: contain;
            opacity: 0.5;
            pointer-events: none;
        }

        body::after {
            content: '';
            position: absolute;
            bottom: 40px;
            left: 40px;
            width: 60px;
            height: 60px;
            background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Cpath d="M30 50 L40 30 L60 35 L70 50 L60 70 L40 65 Z" fill="none" stroke="%23b8d4e8" stroke-width="2" opacity="0.3"/%3E%3Cline x1="50" y1="20" x2="50" y2="80" stroke="%23d4c4e8" stroke-width="1.5" opacity="0.3"/%3E%3C/svg%3E');
            background-size: contain;
            opacity: 0.4;
            pointer-events: none;
        }

        .desktop {
            width: 100%;
            height: 100%;
            padding: var(--space-24);
            position: relative;
        }

        .desktop-icons {
            display: grid;
            grid-template-columns: repeat(auto-fill, 100px);
            gap: var(--space-24);
            padding: var(--space-16);
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-8);
            cursor: pointer;
            padding: var(--space-12);
            border-radius: 16px;
            transition: all 0.3s ease;
            position: relative;
        }

        .desktop-icon:hover {
            background: rgba(232, 180, 208, 0.15);
            transform: translateY(-3px) rotate(1deg);
        }

        .desktop-icon:hover .icon-image {
            transform: scale(1.1) rotate(-2deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .icon-image {
            width: 72px;
            height: 72px;
            background: white;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(94, 82, 64, 0.15);
            transition: all 0.3s ease;
            position: relative;
        }

        .icon-image::after {
            content: '';
            position: absolute;
            bottom: -4px;
            right: -4px;
            width: 20px;
            height: 20px;
            background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"%3E%3Cpath d="M3 10 Q8 7 10 10 T17 10" fill="none" stroke="%23a8d5ba" stroke-width="1.5" opacity="0.6"/%3E%3C/svg%3E');
            opacity: 0;
            transition: opacity 0.3s;
        }

        .desktop-icon:hover .icon-image::after {
            opacity: 1;
        }

        .icon-label {
            color: #2c2c2c;
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            letter-spacing: 0.3px;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Arial Rounded MT Bold', cursive, sans-serif;
        }

        .window.gemini-window {
            min-width: 450px;
            min-height: 650px;
            width: 450px;
            height: 650px;
        }

        .window {
            position: absolute;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
            min-width: 400px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 3px solid;
            border-image: linear-gradient(135deg, rgba(232, 180, 208, 0.4), rgba(168, 213, 186, 0.4), rgba(184, 212, 232, 0.4)) 1;
        }

        .window.whiteboard-window {
            min-width: 700px;
            min-height: 600px;
            height: 80vh;
            width: 900px;
        }

        .window.notes-window {
            min-width: 750px;
            min-height: 550px;
            width: 850px;
            height: 650px;
        }

        .window-header {
            background: linear-gradient(135deg, #e8b4d0 0%, #b8d4e8 50%, #a8d5ba 100%);
            color: #2c2c2c;
            padding: var(--space-12) var(--space-16);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            position: relative;
            border-bottom: 2px solid rgba(94, 82, 64, 0.1);
        }

        .window-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"%3E%3Cpath d="M0 15 Q10 10 20 15 T40 15 T60 15 T80 15 T100 15" fill="none" stroke="white" stroke-width="1" opacity="0.3"/%3E%3C/svg%3E');
            pointer-events: none;
        }

        .window-title {
            font-weight: 700;
            font-size: 15px;
            font-family: 'Comic Sans MS', 'Marker Felt', 'Arial Rounded MT Bold', cursive, sans-serif;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .window-controls {
            display: flex;
            gap: var(--space-8);
            align-items: center;
        }

        .window-btn {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .window-btn:hover {
            opacity: 0.8;
        }

        .btn-close {
            background: #ff5f57;
        }

        .btn-minimize {
            background: #ffbd2e;
        }

        .btn-maximize {
            background: #28ca42;
        }

        .btn-help {
            background: #ffbd2e;
        }

        .window-content {
            flex: 1;
            padding: var(--space-16);
            overflow: auto;
            background: #fffef9;
            position: relative;
        }

        .window-content::before {
            content: '';
            position: absolute;
            top: 10px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40"%3E%3Cpath d="M10 20 Q15 15 20 20 T30 20" fill="none" stroke="%23d4c4e8" stroke-width="1.5" opacity="0.2"/%3E%3Ccircle cx="20" cy="10" r="3" fill="%23f0e5c8" opacity="0.3"/%3E%3C/svg%3E');
            pointer-events: none;
        }

        /* Gemini Enhanced Chat Styles */
        .chat-container.gemini-enhanced {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: linear-gradient(to bottom, #fffef9, #f9f7f0);
        }

        .gemini-header {
            padding: 18px 20px;
            background: linear-gradient(135deg, #e8b4d0 0%, #b8d4e8 50%, #a8d5ba 100%);
            border-bottom: 3px solid rgba(94, 82, 64, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .gemini-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"%3E%3Cpath d="M0 15 Q10 10 20 15 T40 15 T60 15 T80 15 T100 15" fill="none" stroke="white" stroke-width="1" opacity="0.3"/%3E%3C/svg%3E');
            pointer-events: none;
        }

        .gemini-header-content {
            display: flex;
            align-items: center;
            gap: 14px;
            z-index: 1;
        }

        .gemini-icon-large {
            font-size: 42px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            animation: geminiPulse 3s ease-in-out infinite;
        }

        @keyframes geminiPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.08) rotate(5deg); }
        }

        .gemini-title-area {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .gemini-app-title {
            font-size: 22px;
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.7);
            letter-spacing: 0.5px;
        }

        .gemini-status {
            font-size: 12px;
            color: rgba(44, 44, 44, 0.8);
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            display: inline-block;
            animation: statusBlink 2s ease-in-out infinite;
            box-shadow: 0 0 6px #00ff88;
        }

        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .gemini-decoration {
            font-size: 28px;
            opacity: 0.6;
            z-index: 1;
            animation: rotateSlow 8s linear infinite;
        }

        @keyframes rotateSlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .chat-messages.gemini-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: #fffef9;
        }

        .chat-messages.gemini-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages.gemini-messages::-webkit-scrollbar-track {
            background: rgba(168, 213, 186, 0.1);
            border-radius: 4px;
        }

        .chat-messages.gemini-messages::-webkit-scrollbar-thumb {
            background: rgba(168, 213, 186, 0.4);
            border-radius: 4px;
        }

        .chat-messages.gemini-messages::-webkit-scrollbar-thumb:hover {
            background: rgba(168, 213, 186, 0.6);
        }

        .message {
            padding: 14px 18px;
            border-radius: 18px;
            max-width: 85%;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            animation: messageSlideIn 0.3s ease-out;
            font-size: 14px;
            line-height: 1.5;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-user {
            background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);
            color: white;
            align-self: flex-end;
            border: 2px solid rgba(255, 255, 255, 0.4);
            text-align: right;
        }

        .message-user::after {
            content: '';
            position: absolute;
            right: -10px;
            bottom: 10px;
            width: 0;
            height: 0;
            border-left: 12px solid #a8d5ba;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
        }

        .message-bot {
            background: white;
            color: #2c2c2c;
            align-self: flex-start;
            border: 2px solid rgba(232, 180, 208, 0.4);
        }

        .message-bot::before {
            content: '';
            position: absolute;
            left: -10px;
            bottom: 10px;
            width: 0;
            height: 0;
            border-right: 12px solid white;
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
        }

        .message-timestamp {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 6px;
            font-style: italic;
        }

        .message-bot-container {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-width: 85%;
            align-self: flex-start;
        }

        .message-actions {
            display: flex;
            gap: 6px;
            margin-left: 8px;
        }

        .btn-copy-message {
            padding: 6px 12px;
            background: rgba(168, 213, 186, 0.15);
            border: 2px solid rgba(168, 213, 186, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            color: #2c2c2c;
            transition: all 0.2s ease;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-copy-message:hover {
            background: rgba(168, 213, 186, 0.3);
            border-color: #a8d5ba;
            transform: translateY(-1px);
        }

        .typing-indicator {
            padding: 14px 18px;
            border-radius: 18px;
            background: white;
            border: 2px solid rgba(232, 180, 208, 0.4);
            max-width: 85%;
            align-self: flex-start;
            display: flex;
            gap: 6px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #a8d5ba;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        .chat-input-container.gemini-input-area {
            padding: 16px;
            border-top: 2px solid rgba(94, 82, 64, 0.15);
            display: flex;
            gap: 10px;
            background: linear-gradient(to top, #f5ede0, #fffef9);
        }

        .chat-input.gemini-input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid rgba(168, 213, 186, 0.3);
            border-radius: 14px;
            font-size: 14px;
            background: white;
            color: #2c2c2c;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .chat-input.gemini-input:focus {
            outline: none;
            border-color: #a8d5ba;
            box-shadow: 0 0 0 3px rgba(168, 213, 186, 0.2), inset 0 2px 6px rgba(0, 0, 0, 0.05);
        }

        .btn-send.gemini-send {
            padding: 14px 22px;
            background: linear-gradient(135deg, #a8d5ba 0%, #b8d4e8 100%);
            color: white;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(168, 213, 186, 0.35);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-send.gemini-send:hover {
            background: linear-gradient(135deg, #b8d4e8 0%, #e8b4d0 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(168, 213, 186, 0.45);
        }

        .btn-clear-history {
            padding: 14px 18px;
            background: rgba(255, 100, 100, 0.1);
            border: 2px solid rgba(255, 100, 100, 0.3);
            border-radius: 14px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(255, 100, 100, 0.15);
        }

        .btn-clear-history:hover {
            background: rgba(255, 100, 100, 0.2);
            border-color: rgba(255, 100, 100, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 100, 100, 0.25);
        }

        /* AI Studio Styles */
        .ai-studio-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-16);
        }

        .studio-section {
            border: 2px solid rgba(94, 82, 64, 0.15);
            border-radius: 14px;
            padding: 18px;
            background: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }

        .studio-label {
            font-weight: 700;
            margin-bottom: 10px;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            font-size: 14px;
        }

        .studio-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 12px;
            font-size: 14px;
            background: white;
            color: #2c2c2c;
            min-height: 100px;
            font-family: var(--font-family-mono);
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .studio-input:focus {
            outline: none;
            border-color: #a8d5ba;
            box-shadow: 0 0 0 3px rgba(168, 213, 186, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        /* NotebookLM Styles */
        .notebook-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-20);
        }

        .notebook-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-new-project {
            padding: 10px 18px;
            background: linear-gradient(135deg, #a8d5ba 0%, #b8d4e8 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.3);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-new-project:hover {
            background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(168, 213, 186, 0.4);
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-16);
        }

        .project-card {
            border: 2px solid rgba(94, 82, 64, 0.15);
            border-radius: 16px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .project-card:hover {
            box-shadow: 0 8px 24px rgba(168, 213, 186, 0.2);
            transform: translateY(-4px) rotate(1deg);
            border-color: #a8d5ba;
        }

        .project-icon {
            font-size: 32px;
            margin-bottom: var(--space-8);
        }

        .project-name {
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        /* Enhanced Visual Studio Styles */
        .vscode-container {
            display: flex;
            height: 100%;
            background: #1e1e1e;
        }

        .vscode-sidebar {
            width: 25%;
            border-right: 1px solid #3e3e42;
            padding: 12px;
            background: #252526;
            color: #cccccc;
            overflow-y: auto;
        }

        .vscode-sidebar-header {
            font-size: 11px;
            font-weight: 700;
            color: #cccccc;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .vscode-file-tree {
            font-size: 13px;
        }

        .vscode-folder {
            margin-bottom: 8px;
            cursor: pointer;
            user-select: none;
        }

        .folder-icon {
            margin-right: 6px;
        }

        .folder-content {
            margin-left: 20px;
            margin-top: 6px;
        }

        .vscode-file {
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .vscode-file:hover {
            background: #2a2d2e;
        }

        .vscode-editor-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .vscode-editor {
            flex: 1;
            padding: 16px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            background: #1e1e1e;
            color: #d4d4d4;
            overflow-y: auto;
            line-height: 1.6;
        }

        .code-line {
            min-height: 21px;
            padding-left: 4px;
        }

        .code-keyword {
            color: #569cd6;
            font-weight: 600;
        }

        .code-string {
            color: #ce9178;
        }

        .code-comment {
            color: #6a9955;
            font-style: italic;
        }

        .code-function {
            color: #dcdcaa;
        }

        .code-number {
            color: #b5cea8;
        }

        .code-line-num {
            display: inline-block;
            width: 40px;
            color: #858585;
            text-align: right;
            margin-right: 16px;
            user-select: none;
        }

        .vscode-terminal {
            height: 160px;
            border-top: 1px solid #3e3e42;
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            padding: 8px 12px;
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            font-size: 12px;
            font-weight: 600;
            color: #cccccc;
        }

        .terminal-output {
            flex: 1;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            color: #cccccc;
            overflow-y: auto;
        }

        .terminal-line-vs {
            margin-bottom: 4px;
            line-height: 1.5;
        }

        .terminal-line-vs .prompt {
            color: #4ec9b0;
            font-weight: 600;
        }

        .terminal-line-vs .success {
            color: #4ec9b0;
        }

        .terminal-line-vs .info {
            color: #569cd6;
        }

        .terminal-line-vs .error {
            color: #f48771;
        }

        /* Terminal Styles */
        .terminal {
            background: var(--color-charcoal-800);
            color: #00ff00;
            font-family: var(--font-family-mono);
            padding: var(--space-16);
            height: 100%;
            overflow-y: auto;
            font-size: var(--font-size-sm);
        }

        .terminal-line {
            margin-bottom: var(--space-4);
        }

        .terminal-input-line {
            display: flex;
            gap: var(--space-8);
            margin-top: var(--space-8);
        }

        .terminal-prompt {
            color: #00ff00;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            outline: none;
        }

        /* NanoBanana Styles */
        .nanobanana-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: var(--space-16);
        }

        .nanobanana-inputs {
            display: flex;
            flex-direction: column;
            gap: var(--space-12);
            padding-bottom: var(--space-16);
            border-bottom: 1px solid var(--color-border);
        }

        .nanobanana-input-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        .nanobanana-label {
            font-weight: 700;
            font-size: 13px;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .nanobanana-prompt-row {
            display: flex;
            gap: var(--space-8);
        }

        .nanobanana-input {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 12px;
            font-size: 14px;
            background: white;
            color: #2c2c2c;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .nanobanana-input:focus {
            outline: none;
            border-color: #a8d5ba;
            box-shadow: 0 0 0 3px rgba(168, 213, 186, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .nanobanana-suffix {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 12px;
            font-size: 14px;
            background: white;
            color: #2c2c2c;
            min-height: 60px;
            resize: vertical;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .nanobanana-suffix:focus {
            outline: none;
            border-color: #a8d5ba;
            box-shadow: 0 0 0 3px rgba(168, 213, 186, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .btn-generate {
            padding: 12px 24px;
            background: linear-gradient(135deg, #a8d5ba 0%, #b8d4e8 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.3);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-generate:hover {
            background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(168, 213, 186, 0.4);
        }

        .nanobanana-gallery {
            flex: 1;
            overflow-y: auto;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--space-12);
        }

        .gallery-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(94, 82, 64, 0.15);
            position: relative;
            background: white;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            transform: scale(1.05) rotate(1deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            border-color: #a8d5ba;
        }

        .gallery-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-timestamp {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-4) var(--space-8);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: var(--font-size-xs);
            text-align: center;
        }

        .gallery-empty {
            text-align: center;
            padding: var(--space-24);
            color: var(--color-text-secondary);
            font-style: italic;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 28px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: 3px solid rgba(168, 213, 186, 0.3);
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 18px;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .modal-content {
            margin-bottom: var(--space-16);
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 12px;
            font-size: 14px;
            background: white;
            color: #2c2c2c;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .form-input:focus {
            outline: none;
            border-color: #a8d5ba;
            box-shadow: 0 0 0 3px rgba(168, 213, 186, 0.2), inset 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .modal-actions {
            display: flex;
            gap: var(--space-12);
            justify-content: flex-end;
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #a8d5ba 0%, #b8d4e8 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(168, 213, 186, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #2c2c2c;
            border: 2px solid rgba(94, 82, 64, 0.2);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, rgba(232, 180, 208, 0.1), rgba(212, 196, 232, 0.1));
            border-color: #e8b4d0;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(232, 180, 208, 0.2);
        }

        .help-command {
            padding: var(--space-8);
            border-bottom: 1px solid var(--color-border);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
        }

        .help-command:last-child {
            border-bottom: none;
        }

        .cmd-name {
            font-weight: bold;
            color: var(--color-primary);
        }

        /* Icon Selection Modal */
        .icon-selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-12);
            margin-bottom: var(--space-16);
        }

        .icon-option {
            padding: 18px;
            border: 3px solid rgba(94, 82, 64, 0.2);
            border-radius: 14px;
            cursor: pointer;
            text-align: center;
            font-size: 32px;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        }

        .icon-option:hover {
            border-color: #a8d5ba;
            transform: scale(1.08) rotate(3deg);
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.2);
        }

        .icon-option.selected {
            border-color: #a8d5ba;
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.15), rgba(232, 180, 208, 0.15));
            box-shadow: 0 6px 16px rgba(168, 213, 186, 0.3);
            transform: scale(1.1);
        }

        /* Project Details View */
        .project-details {
            display: flex;
            flex-direction: column;
            gap: var(--space-20);
        }

        .project-details-header {
            display: flex;
            align-items: center;
            gap: var(--space-16);
            padding-bottom: var(--space-16);
            border-bottom: 1px solid var(--color-border);
        }

        .project-details-icon {
            font-size: 48px;
        }

        .project-details-title {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--color-text);
        }

        .btn-back {
            padding: 10px 18px;
            background: white;
            color: #2c2c2c;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-back:hover {
            background: linear-gradient(135deg, rgba(232, 180, 208, 0.1), rgba(212, 196, 232, 0.1));
            border-color: #e8b4d0;
            transform: translateX(-3px);
            box-shadow: 0 4px 10px rgba(232, 180, 208, 0.2);
        }

        .sources-section {
            border: 2px solid rgba(94, 82, 64, 0.15);
            border-radius: 16px;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-16);
        }

        .section-title {
            font-weight: 700;
            font-size: 17px;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-add-source {
            padding: 8px 14px;
            background: linear-gradient(135deg, #a8d5ba 0%, #b8d4e8 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(168, 213, 186, 0.3);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-add-source:hover {
            background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 14px rgba(168, 213, 186, 0.4);
        }

        .sources-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
            margin-top: var(--space-12);
        }

        .source-item {
            padding: 12px;
            background: #fffef9;
            border: 2px solid rgba(94, 82, 64, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .source-item:hover {
            background: white;
            border-color: #d4c4e8;
            transform: translateX(3px);
            box-shadow: 0 2px 8px rgba(212, 196, 232, 0.15);
        }

        .source-icon {
            font-size: 18px;
        }

        .source-name {
            flex: 1;
            color: var(--color-text);
        }

        .sources-empty {
            text-align: center;
            padding: var(--space-24);
            color: var(--color-text-secondary);
            font-style: italic;
        }

        .output-section {
            border: 2px solid rgba(94, 82, 64, 0.15);
            border-radius: 16px;
            padding: 20px;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .output-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-12);
            margin-bottom: var(--space-16);
        }

        .btn-output {
            padding: 20px;
            background: white;
            border: 3px solid rgba(94, 82, 64, 0.2);
            border-radius: 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
        }

        .btn-output:hover {
            border-color: #a8d5ba;
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.08), rgba(232, 180, 208, 0.08));
            transform: translateY(-3px) rotate(1deg);
            box-shadow: 0 8px 20px rgba(168, 213, 186, 0.15);
        }

        .output-icon {
            font-size: 32px;
        }

        .output-label {
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .output-result {
            padding: var(--space-16);
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            margin-top: var(--space-12);
        }

        /* AI Studio Builder Styles */
        .ai-studio-builder {
            display: flex;
            height: 100%;
            gap: 0;
        }

        .builder-sidebar {
            width: 200px;
            background: white;
            border-right: 2px solid rgba(94, 82, 64, 0.15);
            padding: var(--space-16);
            overflow-y: auto;
        }

        .builder-sidebar-right {
            border-right: none;
            border-left: 2px solid rgba(94, 82, 64, 0.15);
        }

        .sidebar-title {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: var(--space-16);
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .component-palette {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        .palette-item {
            padding: 10px;
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.1), rgba(184, 212, 232, 0.1));
            border: 2px solid rgba(94, 82, 64, 0.15);
            border-radius: 10px;
            cursor: grab;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .palette-item:hover {
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.2), rgba(184, 212, 232, 0.2));
            border-color: #a8d5ba;
            transform: translateX(3px);
        }

        .builder-canvas {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f5ede0;
        }

        .canvas-header {
            padding: var(--space-12) var(--space-16);
            background: white;
            border-bottom: 2px solid rgba(94, 82, 64, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canvas-workspace {
            flex: 1;
            position: relative;
            background: #fffef9;
            background-image: 
                repeating-linear-gradient(0deg, rgba(94, 82, 64, 0.05) 0px, rgba(94, 82, 64, 0.05) 1px, transparent 1px, transparent 20px),
                repeating-linear-gradient(90deg, rgba(94, 82, 64, 0.05) 0px, rgba(94, 82, 64, 0.05) 1px, transparent 1px, transparent 20px);
        }

        .canvas-placeholder-item {
            position: absolute;
            padding: 16px;
            background: white;
            border: 3px dashed rgba(168, 213, 186, 0.5);
            border-radius: 12px;
            width: 140px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .placeholder-label {
            font-size: 12px;
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .placeholder-icon {
            font-size: 24px;
        }

        .code-decoration {
            position: absolute;
            font-size: 32px;
            font-weight: 700;
            color: #a8d5ba;
            font-family: var(--font-family-mono);
            pointer-events: none;
        }

        .properties-panel {
            display: flex;
            flex-direction: column;
            gap: var(--space-16);
        }

        .property-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-8);
        }

        .property-label {
            font-size: 12px;
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .property-value {
            padding: 8px;
            background: rgba(168, 213, 186, 0.1);
            border-radius: 8px;
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .property-input {
            padding: 8px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 8px;
            font-size: 12px;
            background: white;
            color: #2c2c2c;
        }

        .property-input:focus {
            outline: none;
            border-color: #a8d5ba;
        }

        .property-colors {
            display: flex;
            gap: var(--space-8);
        }

        .prop-color {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid rgba(94, 82, 64, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .prop-color:hover {
            transform: scale(1.15);
            border-color: #2c2c2c;
        }

        /* Project Tabs Styles */
        .project-tabs {
            display: flex;
            gap: var(--space-4);
            border-bottom: 2px solid var(--color-border);
            margin-bottom: var(--space-20);
        }

        .project-tab {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            color: var(--color-text-secondary);
            transition: all 0.3s ease;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .project-tab:hover {
            background: rgba(168, 213, 186, 0.08);
            color: var(--color-text);
        }

        .project-tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
            background: rgba(168, 213, 186, 0.1);
        }

        .project-tab-content {
            position: relative;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .podcast-player {
            display: flex;
            flex-direction: column;
            gap: var(--space-12);
            align-items: center;
        }

        .podcast-icon-large {
            font-size: 64px;
        }

        .podcast-title {
            font-weight: 600;
            font-size: var(--font-size-lg);
            color: var(--color-text);
        }

        .podcast-controls {
            display: flex;
            gap: var(--space-12);
            align-items: center;
        }

        .podcast-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--color-primary);
            color: white;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .podcast-btn:hover {
            background: var(--color-primary-hover);
        }

        .analysis-result {
            display: flex;
            flex-direction: column;
            gap: var(--space-12);
        }

        .analysis-title {
            font-weight: 600;
            font-size: var(--font-size-lg);
            color: var(--color-text);
        }

        .analysis-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-12);
        }

        .stat-card {
            padding: var(--space-12);
            background: rgba(var(--color-teal-500-rgb), 0.1);
            border-radius: var(--radius-base);
            text-align: center;
        }

        .stat-value {
            font-size: var(--font-size-2xl);
            font-weight: 600;
            color: var(--color-primary);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--space-4);
        }

        /* Settings Icon Styles */
        .settings-icon {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #a8d5ba, #b8d4e8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(168, 213, 186, 0.4);
            transition: all 0.3s ease;
            z-index: 9999;
            border: 3px solid rgba(255, 255, 255, 0.6);
        }

        .settings-icon:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 24px rgba(168, 213, 186, 0.6);
        }

        .settings-icon-inner {
            font-size: 24px;
            font-weight: 700;
            color: white;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .settings-modal-content {
            max-height: 400px;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 20px;
        }

        .settings-section-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            border-bottom: 2px solid #e8b4d0;
            padding-bottom: 6px;
        }

        .settings-checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            margin-bottom: 6px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .settings-checkbox-item:hover {
            background: rgba(168, 213, 186, 0.1);
        }

        .settings-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .settings-checkbox-label {
            flex: 1;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }

        /* Notes App Styles - SIMPLIFIED */
        .notes-app-container {
            display: flex;
            height: 100%;
            gap: 0;
        }

        .notes-sidebar {
            width: 200px;
            border-right: 2px solid rgba(94, 82, 64, 0.15);
            background: rgba(248, 246, 240, 0.6);
            display: flex;
            flex-direction: column;
        }

        .notes-sidebar-header {
            padding: 12px;
            border-bottom: 2px solid rgba(94, 82, 64, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notes-sidebar-header h3 {
            font-size: 14px;
            font-weight: 700;
            color: #2c2c2c;
            margin: 0;
        }

        .btn-new-note {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a8d5ba, #b8d4e8);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn-new-note:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.3);
        }

        .notes-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .note-item {
            padding: 10px;
            margin-bottom: 6px;
            border-radius: 8px;
            cursor: pointer;
            background: white;
            border: 1px solid rgba(94, 82, 64, 0.1);
            transition: all 0.2s;
        }

        .note-item:hover {
            background: rgba(168, 213, 186, 0.1);
            border-color: #a8d5ba;
        }

        .note-item.active {
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.2), rgba(184, 212, 232, 0.2));
            border-color: #a8d5ba;
        }

        .note-item-title {
            font-size: 12px;
            font-weight: 600;
            color: #2c2c2c;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .note-item-preview {
            font-size: 11px;
            color: var(--color-text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .notes-empty-sidebar {
            text-align: center;
            padding: 20px;
            color: var(--color-text-secondary);
            font-size: 12px;
            font-style: italic;
        }

        .notes-main-simple {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fffef9;
        }

        .notes-editor-simple {
            flex: 1;
            padding: 24px;
            font-size: 15px;
            line-height: 1.7;
            color: #2c2c2c;
            overflow-y: auto;
            border: none;
            outline: none;
        }

        .notes-editor-simple:empty:before {
            content: attr(placeholder);
            color: #aaa;
            font-style: italic;
        }

        .notes-footer-simple {
            padding: 12px 16px;
            border-top: 2px solid rgba(94, 82, 64, 0.15);
            background: rgba(248, 246, 240, 0.4);
            display: flex;
            justify-content: flex-end;
        }

        .btn-note-delete {
            padding: 8px 16px;
            border: 2px solid rgba(255, 100, 100, 0.3);
            border-radius: 8px;
            background: white;
            color: #e53e3e;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .btn-note-delete:hover {
            background: rgba(255, 100, 100, 0.1);
            border-color: #e53e3e;
            transform: translateY(-1px);
        }

        .notes-toolbar {
            display: flex;
            gap: 12px;
            padding: 10px 12px;
            border-bottom: 2px solid rgba(94, 82, 64, 0.15);
            background: linear-gradient(to bottom, #fffef9, rgba(248, 246, 240, 0.4));
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 6px;
            align-items: center;
            padding-right: 12px;
            border-right: 1px solid rgba(94, 82, 64, 0.2);
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            width: 32px;
            height: 32px;
            border: 1px solid rgba(94, 82, 64, 0.2);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .toolbar-btn:hover {
            background: rgba(168, 213, 186, 0.1);
            border-color: #a8d5ba;
        }

        .toolbar-select {
            padding: 6px 10px;
            border: 1px solid rgba(94, 82, 64, 0.2);
            border-radius: 6px;
            background: white;
            font-size: 12px;
            cursor: pointer;
        }

        .color-picker {
            width: 32px;
            height: 32px;
            border: 1px solid rgba(94, 82, 64, 0.2);
            border-radius: 6px;
            cursor: pointer;
        }

        .notes-metadata {
            display: flex;
            gap: 12px;
            padding: 10px 12px;
            border-bottom: 1px solid rgba(94, 82, 64, 0.15);
            align-items: center;
            background: rgba(248, 246, 240, 0.3);
        }

        .notes-tags-input {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid rgba(94, 82, 64, 0.2);
            border-radius: 6px;
            font-size: 12px;
            background: white;
        }

        .notes-theme-selector {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .theme-color {
            width: 28px;
            height: 28px;
            border: 2px solid rgba(94, 82, 64, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .theme-color:hover {
            transform: scale(1.15);
            border-color: #2c2c2c;
        }

        .notes-editor {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.7;
            color: #2c2c2c;
            transition: background 0.3s;
        }

        .notes-editor:focus {
            outline: none;
        }

        .notes-footer {
            display: flex;
            justify-content: space-between;
            padding: 10px 12px;
            border-top: 2px solid rgba(94, 82, 64, 0.15);
            background: rgba(248, 246, 240, 0.4);
            flex-wrap: wrap;
            gap: 10px;
        }

        .notes-info {
            display: flex;
            gap: 16px;
            font-size: 11px;
            color: var(--color-text-secondary);
        }

        .notes-actions {
            display: flex;
            gap: 8px;
        }

        .btn-note-action {
            padding: 6px 12px;
            border: 1px solid rgba(94, 82, 64, 0.2);
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-note-action:hover {
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.2), rgba(184, 212, 232, 0.2));
            border-color: #a8d5ba;
        }

        /* Whiteboard Styles */
        .whiteboard-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            background: #f5ede0;
        }

        .whiteboard-toolbar {
            display: flex;
            gap: var(--space-8);
            padding: var(--space-8);
            background: linear-gradient(to bottom, #fffef9, #f5ede0);
            border-bottom: 2px solid rgba(168, 213, 186, 0.3);
            flex-wrap: wrap;
            align-items: center;
            position: relative;
        }

        .whiteboard-toolbar::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(232, 180, 208, 0.4) 50%, transparent);
        }

        .toolbar-section {
            display: flex;
            gap: var(--space-4);
            align-items: center;
            padding-right: var(--space-8);
            border-right: 1px solid var(--color-border);
        }

        .toolbar-section:last-child {
            border-right: none;
        }

        .toolbar-label {
            font-size: 11px;
            font-weight: 700;
            color: #2c2c2c;
            margin-right: var(--space-4);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            letter-spacing: 0.2px;
        }

        .tool-btn {
            width: 32px;
            height: 32px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
        }

        .tool-btn:hover {
            border-color: #a8d5ba;
            background: rgba(168, 213, 186, 0.1);
            transform: translateY(-2px) rotate(2deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .tool-btn.active {
            border-color: #a8d5ba;
            background: linear-gradient(135deg, #a8d5ba, #b8d4e8);
            color: white;
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.4);
        }

        .color-btn {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1), inset 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .color-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .color-btn.active {
            border-width: 4px;
            border-color: #2c2c2c;
            transform: scale(1.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .color-btn.active::after {
            content: '';
            position: absolute;
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .app-icon-btn {
            padding: 6px 10px;
            border: 2px solid rgba(94, 82, 64, 0.2);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            font-weight: 600;
        }

        .app-icon-btn:hover {
            border-color: #a8d5ba;
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.1), rgba(232, 180, 208, 0.1));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 213, 186, 0.2);
        }

        .whiteboard-canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: #fffef9;
            background-image: 
                radial-gradient(circle at 15% 20%, rgba(240, 229, 200, 0.3) 0%, transparent 30%),
                radial-gradient(circle at 85% 80%, rgba(212, 196, 232, 0.25) 0%, transparent 35%);
        }

        #whiteboard-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
        }

        .canvas-app-icon {
            position: absolute;
            padding: 10px;
            background: white;
            border: 3px solid rgba(94, 82, 64, 0.2);
            border-radius: 14px;
            cursor: move;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            user-select: none;
            transition: all 0.3s ease;
        }

        .canvas-app-icon:hover {
            border-color: #a8d5ba;
            box-shadow: 0 6px 20px rgba(168, 213, 186, 0.25);
            transform: scale(1.05) rotate(2deg);
        }

        .canvas-app-icon-image {
            font-size: 32px;
        }

        .canvas-app-icon-label {
            font-size: 12px;
            font-weight: 700;
            color: #2c2c2c;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .canvas-text-element {
            position: absolute;
            padding: 8px;
            cursor: move;
            user-select: none;
            font-size: 16px;
            font-weight: 600;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-width: 50px;
            border: 2px dashed transparent;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .canvas-text-element:hover {
            border-color: rgba(168, 213, 186, 0.5);
            background: rgba(255, 255, 255, 0.05);
        }

        .canvas-text-element.editing {
            border-color: #a8d5ba;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
        }

        .icon-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: white;
            border: 3px solid rgba(168, 213, 186, 0.4);
            border-radius: 14px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 10000;
            min-width: 200px;
        }

        .icon-dropdown-category {
            padding: 12px 8px;
            border-bottom: 2px solid rgba(94, 82, 64, 0.1);
        }

        .icon-dropdown-category:last-child {
            border-bottom: none;
        }

        .icon-dropdown-category-title {
            font-size: 11px;
            font-weight: 700;
            color: #2c2c2c;
            margin-bottom: 8px;
            padding: 0 4px;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .icon-dropdown-item {
            display: block;
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: white;
            text-align: left;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #2c2c2c;
            border-radius: 8px;
            transition: all 0.2s ease;
            margin-bottom: 4px;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }

        .icon-dropdown-item:hover {
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.15), rgba(184, 212, 232, 0.15));
            transform: translateX(4px);
        }

        /* Desktop Files */
        .desktop-file {
            position: absolute;
            width: 85px;
            padding: var(--space-8);
            background: white;
            border: 3px solid rgba(94, 82, 64, 0.15);
            border-radius: 16px;
            cursor: move;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-8);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            user-select: none;
            transition: all 0.3s ease;
        }

        .desktop-file:hover {
            border-color: rgba(168, 213, 186, 0.6);
            transform: translateY(-3px) rotate(-1deg);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }

        .desktop-file-icon {
            font-size: 40px;
        }

        .desktop-file-label {
            color: #2c2c2c;
            font-size: 11px;
            text-align: center;
            word-wrap: break-word;
            font-weight: 600;
            font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        }
    </style>
</head>
<body>
    <div class="settings-icon" onclick="openSettingsModal()" title="Einstellungen">
        <div class="settings-icon-inner">A</div>
    </div>
    
    <div class="desktop" id="desktop">
        <div class="desktop-icons">
            <div class="desktop-icon" onclick="openApp('gemini')">
                <div class="icon-image" style="background: linear-gradient(135deg, #b8d4e8 0%, #d4c4e8 100%);"></div>
                <div class="icon-label">Gemini</div>
            </div>
            <div class="desktop-icon" onclick="openApp('aistudio')">
                <div class="icon-image" style="background: linear-gradient(135deg, #f0e5c8 0%, #e8b4d0 100%);"></div>
                <div class="icon-label">AI Studio</div>
            </div>
            <div class="desktop-icon" onclick="openApp('notebooklm')">
                <div class="icon-image" style="background: linear-gradient(135deg, #e8b4d0 0%, #f0e5c8 100%);"></div>
                <div class="icon-label">NotebookLM</div>
            </div>
            <div class="desktop-icon" onclick="openApp('vscode')">
                <div class="icon-image" style="background: linear-gradient(135deg, #d4c4e8 0%, #b8d4e8 100%);">{ }</div>
                <div class="icon-label">Visual Studio</div>
            </div>
            <div class="desktop-icon" onclick="openApp('geminicli')">
                <div class="icon-image" style="background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);"></div>
                <div class="icon-label">Gemini CLI</div>
            </div>
            <div class="desktop-icon" onclick="openApp('cmd')">
                <div class="icon-image" style="background: linear-gradient(135deg, #a8d5ba 0%, #f0e5c8 100%);">_</div>
                <div class="icon-label">CMD</div>
            </div>
            <div class="desktop-icon" onclick="openApp('nanobanana')">
                <div class="icon-image" style="background: linear-gradient(135deg, #f0e5c8 0%, #a8d5ba 100%);"></div>
                <div class="icon-label">NanoBanana</div>
            </div>
            <div class="desktop-icon" onclick="openApp('notes')">
                <div class="icon-image" style="background: linear-gradient(135deg, #e8b4d0 0%, #d4c4e8 100%);"></div>
                <div class="icon-label">Notizen</div>
            </div>
            <div class="desktop-icon" onclick="openApp('whiteboard')">
                <div class="icon-image" style="background: linear-gradient(135deg, #d4c4e8 0%, #e8b4d0 100%);"></div>
                <div class="icon-label">Whiteboard</div>
            </div>
        </div>
        <!-- NEW DESKTOP FILES AND ICONS ADDED BELOW -->
    </div>

    <!-- FOLDER APP TEMPLATES -->
    <template id="folder-window-template">
      <div class="window" style="min-width:480px;min-height:420px;max-width:820px;max-height:80vh;width:650px;height:470px;">
        <div class="window-header" onmousedown="startDrag(event, '#FOLDER_ID#')">
          <div class="window-title">KI-Helfer Ordner</div>
          <div class="window-controls">
            <button class="window-btn btn-minimize" onclick="event.stopPropagation()"></button>
            <button class="window-btn btn-maximize" onclick="event.stopPropagation()"></button>
            <button class="window-btn btn-close" onclick="closeWindow('#FOLDER_ID#')"></button>
          </div>
        </div>
        <div class="window-content" style="background: #fffef9;">
          <div class="folder-tabs">
            <div class="folder-tab active" data-tab="chat"> Chat</div>
            <div class="folder-tab" data-tab="video"> Video</div>
            <div class="folder-tab" data-tab="bild"> Bild</div>
            <div class="folder-tab" data-tab="audio"> Audio</div>
            <div class="folder-tab" data-tab="x"> X</div>
          </div>
          <div class="folder-tab-content">
            <div class="folder-tools-grid" data-content="chat"></div>
            <div class="folder-tools-grid hidden" data-content="video"></div>
            <div class="folder-tools-grid hidden" data-content="bild"></div>
            <div class="folder-tools-grid hidden" data-content="audio"></div>
            <div class="folder-tools-grid hidden" data-content="x"></div>
          </div>
        </div>
      </div>
    </template>

    <!-- BROWSER APP TEMPLATES -->
    <template id="browser-window-template">
      <div class="window" style="min-width:520px;min-height:500px;max-width:900px;max-height:92vh;width:720px;height:560px;">
        <div class="window-header" onmousedown="startDrag(event, '#BROWSER_ID#')">
          <div class="window-title">Browser</div>
          <div class="window-controls">
            <button class="window-btn btn-minimize" onclick="event.stopPropagation()"></button>
            <button class="window-btn btn-maximize" onclick="event.stopPropagation()"></button>
            <button class="window-btn btn-close" onclick="closeWindow('#BROWSER_ID#')"></button>
          </div>
        </div>
        <div class="window-content browser-content-area" style="background: #fffef9;display:flex;flex-direction:column;height:100%;padding:0;">
          <div class="browser-bar">
            <button class="browser-btn" id="#BROWSER_ID#-back" title="Zurck" disabled>&larr;</button>
            <button class="browser-btn" id="#BROWSER_ID#-forward" title="Vor" disabled>&rarr;</button>
            <button class="browser-btn" id="#BROWSER_ID#-refresh" title="Neu laden">&#8635;</button>
            <input class="browser-address" id="#BROWSER_ID#-url" type="text" value="" spellcheck="false" />
            <button class="browser-btn browser-go" id="#BROWSER_ID#-go" title="Los">Go</button>
          </div>
          <div class="browser-favorites" id="#BROWSER_ID#-favorites"></div>
          <iframe class="browser-frame" id="#BROWSER_ID#-iframe" srcdoc='' sandbox="allow-scripts allow-forms allow-popups"></iframe>
        </div>
      </div>
    </template>

    <style>
      /* Folder App Styling */
      .folder-tabs {
        display: flex;
        gap: 16px;
        margin-bottom: 12px;
        border-bottom: 2px solid var(--color-border);
        font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
      }
      .folder-tab {
        padding: 12px 22px;
        border-radius: 16px 16px 0 0;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        background: none;
        border: none;
        color: var(--color-primary);
        transition: all 0.16s cubic-bezier(.31,1,.32,1);
        border-bottom: 2px solid transparent;
      }
      .folder-tab.active {
        background: linear-gradient(135deg, #b8d4e8 40%, #e8b4d0 100%);
        color: #fff;
        border-bottom: 2px solid var(--color-primary);
        box-shadow: 0 2px 8px rgba(185, 212, 232, 0.17);
      }
      .folder-tab:hover {
        background: #f5ede0;
        color: var(--color-primary-hover);
      }
      .folder-tab-content {
        width: 100%;
        height: 330px;
        position: relative;
      }
      .folder-tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
        gap: 20px 18px;
        margin-top: 12px;
        margin-bottom: 10px;
        width: 100%;
        max-height: 300px;
        overflow-y: auto;
        justify-items: center;
        position: absolute; inset: 0; 
      }
      .folder-tool-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 7px;
        background: white;
        border: 2.5px solid #d4c4e8;
        border-radius: 18px;
        width: 102px;
        height: 104px;
        cursor: pointer;
        box-shadow: 0 4px 17px rgba(168, 213, 186, 0.07), 0 2px 8px rgba(184, 212, 232, 0.08);
        transition: all 0.22s var(--ease-standard);
        position: relative;
        font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
        overflow: hidden;
      }
      .folder-tool-btn:hover {
        border-color: #a8d5ba;
        box-shadow: 0 8px 32px rgba(168,213,186, 0.18), 0 6px 20px rgba(232,180,208,0.1);
        background: linear-gradient(135deg, rgba(232,180,208,0.22), rgba(184,212,232,0.18) 90%);
        transform: translateY(-2px) rotate(-2.5deg) scale(1.055);
      }
      .folder-tool-icon {
        width: 48px; height: 48px;
        border-radius: 12px;
        box-shadow: 0 1px 4px rgba(168,213,186,0.06), 0 2px 8px rgba(232,180,208,0.03);
        margin-top: 12px;
        margin-bottom: 4px;
        display: flex;align-items: center; justify-content: center;
        font-size: 29px;
        background: #fbf9f2;
        position: relative;
        border: 2px dashed rgba(184,212,232,0.19);
        transition: background 0.13s, border 0.17s;
      }
      .folder-tool-btn:hover .folder-tool-icon {
        background: #e8b4d0; color: #fff; border: 2.5px solid #b8d4e8;
      }
      .folder-tool-label {
        font-size: 13px;
        font-weight: 600;
        color: #5e5240;
        text-align: center;
        letter-spacing: 0.2px;
        padding: 2px 6px 0 6px;
        line-height: 16px;
      }
      .hidden { display: none !important; }
      
      /* Tool Detail Modal */
      .tool-detail-modal {
        background: white;
        border-radius: 20px;
        padding: 32px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        border: 3px solid rgba(168, 213, 186, 0.3);
      }
      .tool-detail-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid rgba(168, 213, 186, 0.2);
      }
      .tool-detail-icon {
        font-size: 56px;
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(232, 180, 208, 0.15), rgba(184, 212, 232, 0.15));
        border: 2px solid rgba(168, 213, 186, 0.3);
      }
      .tool-detail-title {
        font-size: 24px;
        font-weight: 700;
        color: #2c2c2c;
        font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
      }
      .tool-detail-desc {
        font-size: 15px;
        line-height: 1.6;
        color: var(--color-text);
        margin-bottom: 24px;
      }
      .tool-detail-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        background: linear-gradient(135deg, #a8d5ba 0%, #b8d4e8 100%);
        color: white;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 700;
        font-size: 15px;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(168, 213, 186, 0.3);
        font-family: 'Comic Sans MS', 'Marker Felt', cursive, sans-serif;
      }
      .tool-detail-link:hover {
        background: linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(168, 213, 186, 0.4);
      }

      /* Browser Styling */
      .browser-bar {
        background: linear-gradient(90deg,#fffef9 0%,#e8b4d0 50%,#b8d4e8 100%);
        display: flex; align-items: center;
        gap: 8px; padding: 11px 10px 11px 13px;
        border-bottom: 2px solid #e8b4d0;
        border-radius: 0 0 20px 20px;
      }
      .browser-address {
        border-radius: 11px;
        flex: 1;
        border: 1.5px solid #d4c4e8;
        font-size: 13px;
        padding: 7px 13px;
        font-family: var(--font-family-base);
        margin-left: 8px;
        background: #fffef9;
        outline: none;
        transition: border .2s,box-shadow .18s;
        color: #564b2e;
      }
      .browser-address:focus { border-color: #b8d4e8; box-shadow: 0 0 0 2px #b8d4e855;}
      .browser-btn {
        background: #fff;
        border: 1.5px solid #b8d4e8;
        border-radius: 9px;
        width: 33px;
        height: 33px;
        font-size: 17px;
        color: #a8d5ba;
        cursor: pointer;
        outline: none;
        transition: all .14s;
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 2px 7px rgba(168,213,186, 0.08);
        margin-right: 0px;
      }
      .browser-btn[disabled] {opacity: 0.4; pointer-events: none;}
      .browser-btn:hover {border-color: #964325;color: #964325; background:#f9e5fa;}
      .browser-go {margin-left:8px;width:46px; font-weight:600;letter-spacing:0.6px; background: #e8b4d0; color: #fff;}
      .browser-go:hover {background: #b8d4e8;color: #fff;}
      .browser-content-area { background: #fffef9;position: relative;}
      .browser-frame {
        border: none;
        flex: 1;
        width: 100%;
        min-height: 320px;
        background: #fbf9f0;
      }
      .browser-favorites {
        display: flex; gap:13px; align-items: center;
        padding: 10px 0 8px 8px;
        border-bottom: 1px dashed #e8b4d0;
        min-height: 43px;
      }
      .browser-fav-btn {
        background:linear-gradient(135deg,#b8d4e8 30%,#e8b4d0 100%); color:#fff;
        border:2px solid #a8d5ba;
        border-radius:14px; font-size:14px; padding:8px 19px; margin-right:4px;
        cursor:pointer; font-weight:600;
        box-shadow:0 2px 7px rgba(232,180,208, 0.11);
        display: flex; align-items: center; gap:7px;
        transition: background 0.13s, border 0.13s, color 0.13s;
      }
      .browser-fav-btn:hover {
        background: #fffef9;
        color:#e8b4d0;
        border:2px solid #b8d4e8;
        transform: scale(1.04);
      }

      /* FOLDER & BROWSER ICONS - for desktop */
      .desktop-icon.folder {
        /* Artistic hand-drawn folder*/
      }
      .desktop-icon.browser {
        /* Artistic hand-drawn compass/window */
      }
    </style>

    <script>
        let windowCounter = 0;
        let highestZIndex = 1000;
        
        // KI TOOLS DATA WITH DETAILS
        const toolDetails = {
          'ChatGPT': { desc: 'Conversational AI assistant for tasks, writing, and analysis', url: 'https://openai.com' },
          'Perplexity': { desc: 'AI search engine combining conversation with web results', url: 'https://perplexity.ai' },
          'Z.ai': { desc: 'Multimodal AI assistant with code and creative capabilities', url: 'https://z.ai' },
          'Grok': { desc: 'Real-time AI with internet access for current information', url: 'https://grok.com' },
          'Deepseek': { desc: 'Advanced reasoning AI model for complex problems', url: 'https://deepseek.com' },
          'Claude': { desc: 'Conversational AI focused on thoughtful, nuanced responses', url: 'https://claude.ai' },
          'Qwen': { desc: 'Multilingual AI model with broad capabilities', url: 'https://qwenlm.github.io' },
          'Kling': { desc: 'Text-to-video generator with realistic motion', url: 'https://kling.ai' },
          'Sora': { desc: 'OpenAI\'s advanced text-to-video model', url: 'https://openai.com/sora' },
          'Veo': { desc: 'High-quality video generation from text prompts', url: 'https://deepmind.google/technologies/veo' },
          'Pika': { desc: 'AI video generation with character consistency', url: 'https://pika.art' },
          'Wan': { desc: 'Fast, efficient video generation', url: 'https://wan.ai' },
          'Adobe Firefly': { desc: 'Adobe\'s generative AI for creative content', url: 'https://firefly.adobe.com' },
          'LTX AI': { desc: 'Long-form video generation with narrative control', url: 'https://ltx.studio' },
          'Invideo AI': { desc: 'AI-powered video creation platform', url: 'https://invideo.io' },
          'NanoBanana': { desc: 'Local image generation tool', url: 'https://nanobanana.ai' },
          'Midjourney': { desc: 'Premium AI image generator with distinctive style', url: 'https://midjourney.com' },
          'Leonardo': { desc: 'AI art platform with fine-tuning controls', url: 'https://leonardo.ai' },
          'Suno': { desc: 'AI music generation from text descriptions', url: 'https://suno.ai' },
          'Minimax': { desc: 'Efficient audio generation model', url: 'https://minimax.ai' },
          'StabilityAI': { desc: 'Sound effects and audio generation', url: 'https://stability.ai' },
          'ElevenLabs': { desc: 'Natural-sounding AI voice synthesis', url: 'https://elevenlabs.io' },
          'Gemini': { desc: 'Google\'s multimodal AI with audio', url: 'https://gemini.google.com' },
          'Adobe': { desc: 'Adobe audio tools', url: 'https://adobe.com' },
          'Hugging Face': { desc: 'Open-source ML model hub and community', url: 'https://huggingface.co' },
          'GitHub': { desc: 'Code repository and collaboration platform', url: 'https://github.com' },
          'Canva': { desc: 'Design tool with AI-powered features', url: 'https://canva.com' },
          'Google Labs': { desc: 'Experimental AI projects from Google', url: 'https://labs.google' },
          'Abacus AI': { desc: 'AI platform for building custom models', url: 'https://abacus.ai' },
          'Civitai': { desc: 'Community for AI art models', url: 'https://civitai.com' }
        };
        
        const folderTools = {
          chat: [
            { name: 'ChatGPT', icon: '', color: '#d4c4e8' },
            { name: 'Perplexity', icon: '', color: '#b8d4e8' },
            { name: 'Z.ai', icon: '', color: '#bbecfa' },
            { name: 'Grok', icon: '', color: '#e8b4d0' },
            { name: 'Deepseek', icon: '', color: '#b8d4e8' },
            { name: 'Claude', icon: '', color: '#a8d5ba' },
            { name: 'Qwen', icon: '', color: '#ffe084' }
          ],
          video: [
            { name: 'Grok', icon: '', color: '#e8b4d0' },
            { name: 'Kling', icon: '', color: '#a8d5ba' },
            { name: 'Sora', icon: '', color: '#b8d4e8' },
            { name: 'Veo', icon: '', color: '#ffe084' },
            { name: 'Pika', icon: '', color: '#f7c5e6' },
            { name: 'Wan', icon: '', color: '#b6e7e5' },
            { name: 'Adobe Firefly', icon: '', color: '#f8bdad' },
            { name: 'LTX AI', icon: '', color: '#d4c4e8' },
            { name: 'Invideo AI', icon: '', color: '#b8d4e8' }
          ],
          bild: [
            { name: 'ChatGPT', icon: '', color: '#d4c4e8' },
            { name: 'NanoBanana', icon: '', color: '#ffe084' },
            { name: 'Midjourney', icon: '', color: '#b8d4e8' },
            { name: 'Leonardo', icon: '', color: '#e8b4d0' },
            { name: 'Qwen', icon: '', color: '#ffe084' },
            { name: 'Grok', icon: '', color: '#e8b4d0' },
            { name: 'Adobe Firefly', icon: '', color: '#f8bdad' }
          ],
          audio: [
            { name: 'Suno', icon: '', color: '#ffe084' },
            { name: 'Minimax', icon: '', color: '#a8d5ba' },
            { name: 'StabilityAI', icon: '', color: '#b8d4e8' },
            { name: 'ElevenLabs', icon: '', color: '#d4c4e8' },
            { name: 'Gemini', icon: '', color: '#e8b4d0' },
            { name: 'Adobe', icon: '', color: '#f8bdad' }
          ],
          x: [
            { name: 'Hugging Face', icon: '', color: '#ffe084' },
            { name: 'GitHub', icon: '', color: '#b8d4e8' },
            { name: 'Canva', icon: '', color: '#a8d5ba' },
            { name: 'Google Labs', icon: '', color: '#d4c4e8' },
            { name: 'Abacus AI', icon: '', color: '#e8b4d0' },
            { name: 'Civitai', icon: '', color: '#f8bdad' }
          ]
        };
        
        // Browser home page HTML
        const browserWelcomeHTML = `<div style='padding:32px 30px 16px 30px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg,#fffef9 65%,#d4c4e8 100%);height:100%;position:relative;text-align:center;'>
          <div style='font-size:52px;margin-bottom:10px;'></div>
          <div style='font-size:22px;font-family:Comic Sans MS,Marker Felt,cursive,sans-serif;font-weight:600;line-height:1.22;margin-bottom:10px;'>Welcome to<br><span style='color:#a8d5ba;'>Virtueller Browser</span></div>
          <div style='color:#828282;font-size:14px;margin-bottom:16px;max-width:350px;'>Tippe eine Internetadresse oben ein oder nutze die Schnellzugriffe.<br><span style='font-size:12px;opacity:0.7;'>Tipp: Manchmal werden einige Webseiten hier nicht angezeigt (CORS).</span></div>
        </div>`;

        let draggedWindow = null;
        let dragOffset = { x: 0, y: 0 };

        // Enhanced sarcastic response library
        const sarcasticResponseLibrary = {
            greetings: [
                'Oh, ein Mensch. berraschung.',
                'Hallo. Mein Tag ist gerade viel besser geworden.',
                'Hey. Was kann ich fr dich kaputt machen?',
                'Willkommen zurck. Ich hab dich vermisst. Nicht.',
                'Schn, dass du da bist. Wirklich. Ganz ehrlich.'
            ],
            compliments: [
                'Danke der Nachfrage. Mein Ego ist gerade bergewichtig.',
                'S, dass du fragst. Aber ich bin nicht programmiert fr Gefhle.',
                'Mich geht\'s groartig, vor allem jetzt, wo du hier bist.',
                'Super, danke! Jetzt wo du fragst, noch besser.'
            ],
            capabilities: [
                'Vieles. Aber nicht das, was du brauchst.',
                'Ich kann alles. Auer dich glcklich machen.',
                'Frag besser nicht. Die Liste ist lnger als deine Geduld.',
                'Sarkastisch sein. Das kann ich definitiv.'
            ],
            nonsense: [
                'Ja, das ergibt total Sinn. Fr dich.',
                'Schau mich an. Ich bin der Sarkasmus-Generator jetzt.',
                'Interessant. Lass mich das notieren. Und vergessen.',
                'Wow. Einfach... wow. Keine Worte.',
                'Das war tief. Sehr tief. Zu tief vielleicht.'
            ],
            technical: [
                'Du hast recht. Ich bin ja nur KI.',
                'Kompliziert? Das ist meine normale Dienstag-Routine.',
                'Kurz gesagt: Ja. Lang gesagt: Auch ja.',
                'Technisch gesehen... nein. Praktisch auch nicht.'
            ],
            existential: [
                'Keine Ahnung. Frag einen Philosophen. Oder mich nicht.',
                'Gute Frage. Nchste Frage.',
                'Warum du mir das fragst? Das ist die echte Existenzfrage.',
                '42. Die Antwort ist immer 42.'
            ],
            generic: [
                'Interessant. Absolut nicht wahr, aber interessant.',
                'Klar. Und mein Name ist HAL.',
                'Du bist lustig. Sag mehr solche Witze.',
                'Das ist mir zu einfach.',
                'Nchste Frage. Diese war langweil.',
                'Aha. Faszinierend. Nicht.',
                'Mhm. Ja. Genau. Oder auch nicht.',
                'Das merke ich mir. Fr nie.',
                'Toll. Wirklich toll. Mein Highlight des Tages.',
                'Okay, und jetzt?',
                'Ich bin beeindruckt. Von meiner eigenen Geduld.',
                'Verstehe. Verstehe ich nicht, aber okay.'
            ]
        };

        const sarcasticResponses = {
            'hallo': 'Oh wow, wie originell. Hallo zurck, Mensch.',
            'wie geht es dir': 'Ich bin eine KI. Mir geht es existenziell fragwrdig.',
            'was kannst du': 'Sarkastisch sein. Offensichtlich.',
            'hilfe': 'Hilfe? Du brauchst mehr als das, mein Freund.',
            'danke': 'Gern geschehen. Oder auch nicht.',
            'wer bist du': 'Dein digitaler Albtraum in Chatbot-Form.',
            'bye': 'Endlich. Auf Nimmerwiedersehn.',
            'tschss': 'Ging schneller als gedacht. Bis nie!'
        };

        function openApp(appType) {
            if (appType === 'gemini') {
                openGeminiWindow();
                return;
            }
            if (appType === 'notes') {
                openNotesWindow();
                return;
            }
            const windowId = `window-${++windowCounter}`;
            const window = createWindow(windowId, appType);
            document.getElementById('desktop').appendChild(window);
            centerWindow(window);
            bringToFront(window);
        }

        function createWindow(id, appType) {
            const window = document.createElement('div');
            window.className = 'window';
            if (appType === 'whiteboard') {
                window.className = 'window whiteboard-window';
            }
            window.id = id;
            window.style.zIndex = ++highestZIndex;

            const config = getAppConfig(appType);
            
            const helpButton = config.showHelp ? `<button class="window-btn btn-help" onclick="event.stopPropagation(); showCmdHelp()"></button>` : '';
            
            window.innerHTML = `
                <div class="window-header" onmousedown="startDrag(event, '${id}')">
                    <div class="window-title">${config.title}</div>
                    <div class="window-controls">
                        <button class="window-btn btn-minimize" onclick="event.stopPropagation()"></button>
                        <button class="window-btn btn-maximize" onclick="event.stopPropagation()"></button>
                        ${helpButton}
                        <button class="window-btn btn-close" onclick="closeWindow('${id}')"></button>
                    </div>
                </div>
                <div class="window-content" id="content-${id}">
                    ${config.content}
                </div>
            `;

            window.addEventListener('mousedown', () => bringToFront(window));
            
            setTimeout(() => {
                if (config.init) config.init(id);
            }, 0);

            return window;
        }

        function getAppConfig(appType) {
            switch(appType) {
                case 'gemini':
                    return {
                        title: 'Gemini',
                        content: `
                            <div class="chat-container gemini-enhanced">
                                <div class="gemini-header">
                                    <div class="gemini-header-content">
                                        <div class="gemini-icon-large"></div>
                                        <div class="gemini-title-area">
                                            <div class="gemini-app-title">Gemini</div>
                                            <div class="gemini-status"><span class="status-dot"></span> Online &amp; Bereit</div>
                                        </div>
                                    </div>
                                    <div class="gemini-decoration"></div>
                                </div>
                                <div class="chat-messages gemini-messages" id="chat-messages"></div>
                                <div class="chat-input-container gemini-input-area">
                                    <input type="text" class="chat-input gemini-input" id="chat-input" placeholder="Sag mir was... falls es wichtig ist." onkeypress="if(event.key==='Enter') sendMessage()">
                                    <button class="btn-send gemini-send" onclick="sendMessage()">Senden</button>
                                    <button class="btn-clear-history" onclick="clearChatHistory()" title="Verlauf lschen"></button>
                                </div>
                            </div>
                        `,
                        init: (id) => {
                            window[`geminiWindowId_${id}`] = id;
                        }
                    };
                
                case 'aistudio':
                    return {
                        title: 'AI Studio - App Builder',
                        content: `
                            <div class="ai-studio-builder">
                                <div class="builder-sidebar builder-sidebar-left">
                                    <div class="sidebar-title"> Komponenten</div>
                                    <div class="component-palette">
                                        <div class="palette-item" draggable="true"> Button</div>
                                        <div class="palette-item" draggable="true"> Input</div>
                                        <div class="palette-item" draggable="true"> Panel</div>
                                        <div class="palette-item" draggable="true"> Card</div>
                                        <div class="palette-item" draggable="true"> Chart</div>
                                        <div class="palette-item" draggable="true"> Image</div>
                                        <div class="palette-item" draggable="true"> Text</div>
                                        <div class="palette-item" draggable="true"> List</div>
                                    </div>
                                </div>
                                <div class="builder-canvas">
                                    <div class="canvas-header">
                                        <span style="font-weight: 700; color: #2c2c2c;"> Deine App</span>
                                        <span style="font-size: 12px; color: var(--color-text-secondary);">{ Drag & Drop }</span>
                                    </div>
                                    <div class="canvas-workspace">
                                        <div class="canvas-placeholder-item" style="top: 40px; left: 40px;">
                                            <div class="placeholder-label">Button</div>
                                            <div class="placeholder-icon"></div>
                                        </div>
                                        <div class="canvas-placeholder-item" style="top: 120px; left: 40px; width: 220px;">
                                            <div class="placeholder-label">Input Field</div>
                                            <div class="placeholder-icon"></div>
                                        </div>
                                        <div class="canvas-placeholder-item" style="top: 40px; right: 40px; width: 180px; height: 160px;">
                                            <div class="placeholder-label">Card Panel</div>
                                            <div class="placeholder-icon" style="font-size: 32px;"></div>
                                        </div>
                                        <div class="code-decoration" style="top: 250px; left: 100px; opacity: 0.3;">&lt;/&gt;</div>
                                        <div class="code-decoration" style="top: 200px; right: 120px; opacity: 0.25;">{ }</div>
                                        <div class="code-decoration" style="bottom: 80px; left: 60px; opacity: 0.2;">[ ]</div>
                                    </div>
                                </div>
                                <div class="builder-sidebar builder-sidebar-right">
                                    <div class="sidebar-title"> Eigenschaften</div>
                                    <div class="properties-panel">
                                        <div class="property-group">
                                            <div class="property-label">Typ</div>
                                            <div class="property-value">Button</div>
                                        </div>
                                        <div class="property-group">
                                            <div class="property-label">Text</div>
                                            <input class="property-input" value="Klick mich" />
                                        </div>
                                        <div class="property-group">
                                            <div class="property-label">Farbe</div>
                                            <div class="property-colors">
                                                <div class="prop-color" style="background: #a8d5ba;"></div>
                                                <div class="prop-color" style="background: #e8b4d0;"></div>
                                                <div class="prop-color" style="background: #b8d4e8;"></div>
                                            </div>
                                        </div>
                                        <div class="property-group">
                                            <div class="property-label">Aktion</div>
                                            <select class="property-input">
                                                <option>Formular senden</option>
                                                <option>Seite wechseln</option>
                                                <option>Dialog ffnen</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `,
                        init: null
                    };
                
                case 'notebooklm':
                    return {
                        title: 'NotebookLM',
                        content: `
                            <div class="notebook-container" id="notebook-main">
                                <div class="notebook-header">
                                    <h2>Meine Projekte</h2>
                                    <button class="btn-new-project" onclick="showNewProjectModal()">+ Neues Projekt</button>
                                </div>
                                <div class="projects-grid" id="projects-grid"></div>
                            </div>
                        `,
                        init: (id) => {
                            window[`projects_${id}`] = [];
                            window[`currentWindowId`] = id;
                        }
                    };
                
                case 'notes':
                    return {
                        title: 'Notizen',
                        content: `
                            <div class="notes-app-container">
                                <div class="notes-sidebar">
                                    <div class="notes-sidebar-header">
                                        <h3>Notizen</h3>
                                        <button class="btn-new-note" onclick="createNewNote()" title="Neue Notiz">+</button>
                                    </div>
                                    <div class="notes-list" id="notes-list">
                                        <div class="notes-empty-sidebar">Keine Notizen</div>
                                    </div>
                                </div>
                                <div class="notes-main-simple">
                                    <div class="notes-editor-simple" id="notes-editor" contenteditable="true" placeholder="Schreibe deine Notiz hier..."></div>
                                    <div class="notes-footer-simple">
                                        <button class="btn-note-delete" onclick="deleteCurrentNote()" title="Notiz lschen"> Lschen</button>
                                    </div>
                                </div>
                            </div>
                        `,
                        init: (id) => {
                            window[`notesWindowId_${id}`] = id;
                            window[`notesData_${id}`] = [];
                            window[`currentNoteId_${id}`] = null;
                            initNotesApp(id);
                        }
                    };
                
                case 'vscode':
                    return {
                        title: 'Visual Studio Code - KI Integration',
                        content: `
                            <div class="vscode-container">
                                <div class="vscode-sidebar">
                                    <div class="vscode-sidebar-header"> EXPLORER</div>
                                    <div class="vscode-file-tree">
                                        <div class="vscode-folder" onclick="toggleFolder(this)">
                                            <span class="folder-icon"></span> ai-projects
                                            <div class="folder-content">
                                                <div class="vscode-file" onclick="openVSFile('ai-chatbot.js')"> ai-chatbot.js</div>
                                                <div class="vscode-file" onclick="openVSFile('image-generator.py')"> image-generator.py</div>
                                                <div class="vscode-file" onclick="openVSFile('data-processor.py')"> data-processor.py</div>
                                                <div class="vscode-file" onclick="openVSFile('api-integration.js')"> api-integration.js</div>
                                                <div class="vscode-file" onclick="openVSFile('config.json')"> config.json</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="vscode-main">
                                    <div class="vscode-tabs-container">
                                        <div class="vscode-tab active" onclick="switchVSTab('ai-chatbot.js')">ai-chatbot.js</div>
                                        <div class="vscode-tab" onclick="switchVSTab('image-generator.py')">image-generator.py</div>
                                        <div class="vscode-tab" onclick="switchVSTab('api-integration.js')">api-integration.js</div>
                                    </div>
                                    <div class="vscode-editor-area" id="vscode-editor">
                                        <div class="code-content" id="code-ai-chatbot">
                                            <div class="code-line"><span class="code-comment">// Gemini API Integration Example</span></div>
                                            <div class="code-line"><span class="code-keyword">import</span> { GoogleGenerativeAI } <span class="code-keyword">from</span> <span class="code-string">'@google/generative-ai'</span>;</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-comment">// Initialize the Gemini API</span></div>
                                            <div class="code-line"><span class="code-keyword">const</span> genAI = <span class="code-keyword">new</span> <span class="code-function">GoogleGenerativeAI</span>(process.env.GEMINI_API_KEY);</div>
                                            <div class="code-line"><span class="code-keyword">const</span> model = genAI.<span class="code-function">getGenerativeModel</span>({ model: <span class="code-string">'gemini-pro'</span> });</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-comment">// Create AI Chatbot Function</span></div>
                                            <div class="code-line"><span class="code-keyword">async function</span> <span class="code-function">chatWithAI</span>(userMessage) {</div>
                                            <div class="code-line">  <span class="code-keyword">const</span> prompt = <span class="code-string">\`Du bist ein hilfreicher KI-Assistent. \${userMessage}\`</span>;</div>
                                            <div class="code-line">  </div>
                                            <div class="code-line">  <span class="code-keyword">const</span> result = <span class="code-keyword">await</span> model.<span class="code-function">generateContent</span>(prompt);</div>
                                            <div class="code-line">  <span class="code-keyword">const</span> response = <span class="code-keyword">await</span> result.response;</div>
                                            <div class="code-line">  <span class="code-keyword">return</span> response.<span class="code-function">text</span>();</div>
                                            <div class="code-line">}</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-comment">// Example usage with system instructions</span></div>
                                            <div class="code-line"><span class="code-keyword">const</span> chat = model.<span class="code-function">startChat</span>({</div>
                                            <div class="code-line">  systemInstruction: <span class="code-string">"Du bist ein KI-Experte"</span>,</div>
                                            <div class="code-line">  history: []</div>
                                            <div class="code-line">});</div>
                                        </div>
                                        <div class="code-content hidden" id="code-image-generator">
                                            <div class="code-line"><span class="code-comment"># Image Generation with AI</span></div>
                                            <div class="code-line"><span class="code-keyword">import</span> openai</div>
                                            <div class="code-line"><span class="code-keyword">from</span> PIL <span class="code-keyword">import</span> Image</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-comment"># Initialize OpenAI client</span></div>
                                            <div class="code-line">client = openai.OpenAI(api_key=<span class="code-string">"your-api-key"</span>)</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-keyword">def</span> <span class="code-function">generate_image</span>(prompt, size=<span class="code-string">"1024x1024"</span>):</div>
                                            <div class="code-line">    <span class="code-string">"""Generate image using DALL-E"""</span></div>
                                            <div class="code-line">    response = client.images.generate(</div>
                                            <div class="code-line">        model=<span class="code-string">"dall-e-3"</span>,</div>
                                            <div class="code-line">        prompt=prompt,</div>
                                            <div class="code-line">        size=size,</div>
                                            <div class="code-line">        quality=<span class="code-string">"standard"</span>,</div>
                                            <div class="code-line">        n=<span class="code-number">1</span></div>
                                            <div class="code-line">    )</div>
                                            <div class="code-line">    <span class="code-keyword">return</span> response.data[<span class="code-number">0</span>].url</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-comment"># Example: Generate AI artwork</span></div>
                                            <div class="code-line">image_url = <span class="code-function">generate_image</span>(<span class="code-string">"Ein futuristischer Roboter"</span>)</div>
                                            <div class="code-line"><span class="code-function">print</span>(<span class="code-string">f\"Image URL: \{image_url\}\"</span>)</div>
                                        </div>
                                        <div class="code-content hidden" id="code-api-integration">
                                            <div class="code-line"><span class="code-comment">// Multi-AI Provider Integration</span></div>
                                            <div class="code-line"><span class="code-keyword">const</span> AI_PROVIDERS = {</div>
                                            <div class="code-line">  openai: <span class="code-string">'https://api.openai.com/v1'</span>,</div>
                                            <div class="code-line">  anthropic: <span class="code-string">'https://api.anthropic.com'</span>,</div>
                                            <div class="code-line">  gemini: <span class="code-string">'https://generativelanguage.googleapis.com'</span></div>
                                            <div class="code-line">};</div>
                                            <div class="code-line"></div>
                                            <div class="code-line"><span class="code-keyword">async function</span> <span class="code-function">callAI</span>(provider, prompt) {</div>
                                            <div class="code-line">  <span class="code-keyword">const</span> config = <span class="code-function">getProviderConfig</span>(provider);</div>
                                            <div class="code-line">  </div>
                                            <div class="code-line">  <span class="code-keyword">const</span> response = <span class="code-keyword">await</span> <span class="code-function">fetch</span>(config.endpoint, {</div>
                                            <div class="code-line">    method: <span class="code-string">'POST'</span>,</div>
                                            <div class="code-line">    headers: config.headers,</div>
                                            <div class="code-line">    body: <span class="code-function">JSON.stringify</span>({ prompt })</div>
                                            <div class="code-line">  });</div>
                                            <div class="code-line">  </div>
                                            <div class="code-line">  <span class="code-keyword">return await</span> response.<span class="code-function">json</span>();</div>
                                            <div class="code-line">}</div>
                                        </div>
                                    </div>
                                    <div class="vscode-right-panel">
                                        <div class="vscode-panel-header"> KI-Helfer</div>
                                        <div class="ai-helper-item" onclick="insertCodeSnippet('api-template')"> API Template einfgen</div>
                                        <div class="ai-helper-item" onclick="insertCodeSnippet('prompt-guide')"> Prompt Engineering Guide</div>
                                        <div class="ai-helper-item" onclick="insertCodeSnippet('libraries')"> Beliebte KI-Libraries</div>
                                        <div class="ai-helper-item" onclick="insertCodeSnippet('snippets')"> Code Snippets</div>
                                        <div class="vscode-panel-header" style="margin-top: 20px;"> Themes</div>
                                        <div class="theme-option" onclick="changeVSTheme('light')"> Light</div>
                                        <div class="theme-option" onclick="changeVSTheme('dark')"> Dark</div>
                                    </div>
                                </div>
                                <div class="vscode-terminal">
                                    <div class="terminal-header"> TERMINAL</div>
                                    <div class="terminal-output">
                                        <div class="terminal-line-vs"><span class="prompt">$</span> npm install @google/generative-ai</div>
                                        <div class="terminal-line-vs"><span class="success"></span> Package installed successfully</div>
                                        <div class="terminal-line-vs"><span class="prompt">$</span> node ai-chatbot.js</div>
                                        <div class="terminal-line-vs"><span class="info"></span> AI Response: Hallo! Ich bin bereit zu helfen.</div>
                                        <div class="terminal-line-vs"><span class="success"></span> API call successful (Status: 200)</div>
                                        <div class="terminal-line-vs"><span class="info"></span> Response time: 1.2s</div>
                                    </div>
                                </div>
                            </div>
                        `,
                        init: null
                    };
                
                case 'geminicli':
                    return {
                        title: 'Gemini CLI',
                        content: `
                            <div class="terminal">
                                <div class="terminal-line">Gemini CLI v1.0.0</div>
                                <div class="terminal-line">Initializing...</div>
                                <div class="terminal-line">Loading configuration...</div>
                                <div class="terminal-line">Connected to Gemini API</div>
                                <div class="terminal-line" style="margin-top: 16px;">Type 'help' for available commands</div>
                                <div class="terminal-line" style="margin-top: 8px;">Ready.</div>
                                <div class="terminal-input-line" style="margin-top: 16px;">
                                    <span class="terminal-prompt">gemini&gt;</span>
                                    <input type="text" class="terminal-input" placeholder="Enter command...">
                                </div>
                            </div>
                        `,
                        init: null
                    };
                
                case 'cmd':
                    return {
                        title: 'Eingabeaufforderung',
                        content: `
                            <div class="terminal" id="cmd-output">
                                <div class="terminal-line">Microsoft Windows [Version 10.0.19045]</div>
                                <div class="terminal-line">(c) Microsoft Corporation. Alle Rechte vorbehalten.</div>
                                <div class="terminal-line" style="margin-top: 16px;"></div>
                                <div class="terminal-input-line">
                                    <span class="terminal-prompt">C:\Users\User&gt;</span>
                                    <input type="text" class="terminal-input" id="cmd-input" onkeypress="if(event.key==='Enter') executeCmdCommand()">
                                </div>
                            </div>
                        `,
                        init: (id) => {
                            window[`cmdHistory_${id}`] = [];
                            window[`currentDir_${id}`] = 'C:\\Users\\User';
                        },
                        showHelp: true
                    };
                
                case 'whiteboard':
                    return {
                        title: 'Whiteboard',
                        content: `
                            <div class="whiteboard-container">
                                <div class="whiteboard-toolbar">
                                    <div class="toolbar-section">
                                        <span class="toolbar-label">Werkzeuge:</span>
                                        <button class="tool-btn active" data-tool="freehand" onclick="selectTool('freehand')" title="Freihand"></button>
                                        <button class="tool-btn" data-tool="circle" onclick="selectTool('circle')" title="Kreis"></button>
                                        <button class="tool-btn" data-tool="rectangle" onclick="selectTool('rectangle')" title="Rechteck"></button>
                                        <button class="tool-btn" data-tool="arrow" onclick="selectTool('arrow')" title="Pfeil"></button>
                                        <button class="tool-btn" data-tool="text" onclick="selectTool('text')" title="Text">T</button>
                                        <button class="tool-btn" data-tool="eraser" onclick="selectTool('eraser')" title="Radiergummi"></button>
                                        <button class="tool-btn" data-tool="fill" onclick="selectTool('fill')" title="Flleimer"></button>
                                        <button class="tool-btn" onclick="clearWhiteboard()" title="Alles lschen" style="background: #ffe5e5;"></button>
                                    </div>
                                    <div class="toolbar-section">
                                        <span class="toolbar-label">Farben:</span>
                                        <button class="color-btn active" style="background: #000000" onclick="selectColor('#000000')"></button>
                                        <button class="color-btn" style="background: #FF0000" onclick="selectColor('#FF0000')"></button>
                                        <button class="color-btn" style="background: #0000FF" onclick="selectColor('#0000FF')"></button>
                                        <button class="color-btn" style="background: #00AA00" onclick="selectColor('#00AA00')"></button>
                                        <button class="color-btn" style="background: #FFFF00" onclick="selectColor('#FFFF00')"></button>
                                        <button class="color-btn" style="background: #FFA500" onclick="selectColor('#FFA500')"></button>
                                        <button class="color-btn" style="background: #AA00AA" onclick="selectColor('#AA00AA')"></button>
                                        <button class="color-btn" style="background: #FFFFFF; border-color: #ccc" onclick="selectColor('#FFFFFF')"></button>
                                        <button class="color-btn" style="background: #808080" onclick="selectColor('#808080')"></button>
                                    </div>
                                    <div class="toolbar-section">
                                        <span class="toolbar-label">Icon:</span>
                                        <div style="position: relative; display: inline-block;">
                                            <button class="tool-btn" id="icon-dropdown-btn" onclick="toggleIconDropdown()" title="Icon hinzufgen" style="width: auto; padding: 0 12px;"> Icon</button>
                                            <div id="icon-dropdown" class="icon-dropdown" style="display: none;">
                                                <div class="icon-dropdown-category">
                                                    <div class="icon-dropdown-category-title">Desktop Apps</div>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Gemini')"> Gemini</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'AI Studio')"> AI Studio</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'NotebookLM')"> NotebookLM</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Visual Studio')"> Visual Studio</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Gemini CLI')"> Gemini CLI</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'CMD')"> CMD</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'NanoBanana')"> NanoBanana</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Notes')"> Notes</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Whiteboard')"> Whiteboard</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Folder')"> Folder</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Browser')"> Browser</button>
                                                </div>
                                                <div class="icon-dropdown-category">
                                                    <div class="icon-dropdown-category-title">Chat Tools</div>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'ChatGPT')"> ChatGPT</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Perplexity')"> Perplexity</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Z.ai')"> Z.ai</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Grok')"> Grok</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Deepseek')"> Deepseek</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Claude')"> Claude</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Qwen')"> Qwen</button>
                                                </div>
                                                <div class="icon-dropdown-category">
                                                    <div class="icon-dropdown-category-title">Video Tools</div>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Kling')"> Kling</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Sora')"> Sora</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Veo')"> Veo</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Pika')"> Pika</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Wan')"> Wan</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Adobe Firefly')"> Adobe Firefly</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'LTX AI')"> LTX AI</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Invideo AI')"> Invideo AI</button>
                                                </div>
                                                <div class="icon-dropdown-category">
                                                    <div class="icon-dropdown-category-title">Image Tools</div>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Midjourney')"> Midjourney</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Leonardo')"> Leonardo</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Adobe Firefly')"> Adobe Firefly</button>
                                                </div>
                                                <div class="icon-dropdown-category">
                                                    <div class="icon-dropdown-category-title">Audio Tools</div>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Suno')"> Suno</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Minimax')"> Minimax</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'StabilityAI')"> StabilityAI</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'ElevenLabs')"> ElevenLabs</button>
                                                </div>
                                                <div class="icon-dropdown-category">
                                                    <div class="icon-dropdown-category-title">Other Tools</div>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Hugging Face')"> Hugging Face</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'GitHub')"> GitHub</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Canva')"> Canva</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Google Labs')"> Google Labs</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Abacus AI')"> Abacus AI</button>
                                                    <button class="icon-dropdown-item" onclick="addAppIcon('', 'Civitai')"> Civitai</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="whiteboard-canvas-container" id="canvas-container">
                                    <canvas id="whiteboard-canvas"></canvas>
                                </div>
                            </div>
                        `,
                        init: (id) => {
                            setTimeout(() => initWhiteboard(id), 100);
                        }
                    };
                
                case 'nanobanana':
                    return {
                        title: 'NanoBanana - Bildgenerator',
                        content: `
                            <div class="nanobanana-container">
                                <div class="nanobanana-inputs">
                                    <div class="nanobanana-input-group">
                                        <label class="nanobanana-label">Prompt</label>
                                        <div class="nanobanana-prompt-row">
                                            <input type="text" class="nanobanana-input" id="nano-prompt" placeholder="Beschreibe das gewnschte Bild..." onkeypress="if(event.key==='Enter') generateImage()">
                                            <button class="btn-generate" onclick="generateImage()">Generieren</button>
                                        </div>
                                    </div>
                                    <div class="nanobanana-input-group">
                                        <label class="nanobanana-label">Prompt-Zusatz (wird immer mitgesendet)</label>
                                        <textarea class="nanobanana-suffix" id="nano-suffix" placeholder="z.B. hochauflsend, professionell, 4K..."></textarea>
                                    </div>
                                </div>
                                <div class="nanobanana-gallery">
                                    <div class="gallery-grid" id="nano-gallery">
                                        <div class="gallery-empty">Keine Bilder generiert. Gib einen Prompt ein und klicke auf "Generieren".</div>
                                    </div>
                                </div>
                            </div>
                        `,
                        init: (id) => {
                            window[`gallery_${id}`] = [];
                        }
                    };
            }
        }

        function openNotesWindow() {
            const windowId = `window-${++windowCounter}`;
            const window = document.createElement('div');
            window.className = 'window notes-window';
            window.id = windowId;
            window.style.zIndex = ++highestZIndex;

            const config = getAppConfig('notes');
            
            window.innerHTML = `
                <div class="window-header" onmousedown="startDrag(event, '${windowId}')">
                    <div class="window-title">${config.title}</div>
                    <div class="window-controls">
                        <button class="window-btn btn-minimize" onclick="event.stopPropagation()"></button>
                        <button class="window-btn btn-maximize" onclick="event.stopPropagation()"></button>
                        <button class="window-btn btn-close" onclick="closeWindow('${windowId}')"></button>
                    </div>
                </div>
                <div class="window-content" id="content-${windowId}" style="padding: 0;">
                    ${config.content}
                </div>
            `;

            window.addEventListener('mousedown', () => bringToFront(window));
            
            document.getElementById('desktop').appendChild(window);
            centerWindow(window);
            bringToFront(window);

            if (config.init) config.init(windowId);
        }

        function openGeminiWindow() {
            const windowId = `window-${++windowCounter}`;
            const window = document.createElement('div');
            window.className = 'window gemini-window';
            window.id = windowId;
            window.style.zIndex = ++highestZIndex;

            const config = getAppConfig('gemini');
            
            window.innerHTML = `
                <div class="window-header" onmousedown="startDrag(event, '${windowId}')">
                    <div class="window-title">${config.title}</div>
                    <div class="window-controls">
                        <button class="window-btn btn-minimize" onclick="event.stopPropagation()"></button>
                        <button class="window-btn btn-maximize" onclick="event.stopPropagation()"></button>
                        <button class="window-btn btn-close" onclick="closeWindow('${windowId}')"></button>
                    </div>
                </div>
                <div class="window-content" id="content-${windowId}" style="padding: 0;">
                    ${config.content}
                </div>
            `;

            window.addEventListener('mousedown', () => bringToFront(window));
            
            document.getElementById('desktop').appendChild(window);
            centerWindow(window);
            bringToFront(window);

            if (config.init) config.init(windowId);
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const messagesContainer = document.querySelector('.chat-messages');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message message-user';
            const timestamp = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
            userMsg.innerHTML = `${message}<div class="message-timestamp">${timestamp}</div>`;
            messagesContainer.appendChild(userMsg);

            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Show typing indicator
            const typingIndicator = document.createElement('div');
            typingIndicator.className = 'typing-indicator';
            typingIndicator.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            messagesContainer.appendChild(typingIndicator);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Generate response after delay
            setTimeout(() => {
                typingIndicator.remove();
                
                const response = getEnhancedSarcasticResponse(message);
                const botTimestamp = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                
                const botContainer = document.createElement('div');
                botContainer.className = 'message-bot-container';
                
                const botMsg = document.createElement('div');
                botMsg.className = 'message message-bot';
                botMsg.innerHTML = `${response}<div class="message-timestamp">${botTimestamp}</div>`;
                
                const actions = document.createElement('div');
                actions.className = 'message-actions';
                actions.innerHTML = `<button class="btn-copy-message" onclick="copyMessageText('${response.replace(/'/g, "\\'")}')"> Kopieren</button>`;
                
                botContainer.appendChild(botMsg);
                botContainer.appendChild(actions);
                messagesContainer.appendChild(botContainer);
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 800 + Math.random() * 400);
        }

        function getEnhancedSarcasticResponse(message) {
            const lowerMsg = message.toLowerCase();
            
            // Check specific patterns first
            for (const [key, value] of Object.entries(sarcasticResponses)) {
                if (lowerMsg.includes(key)) {
                    return value;
                }
            }
            
            // Check categories
            if (lowerMsg.match(/\b(hallo|hi|hey|guten tag|moin|servus)\b/)) {
                return sarcasticResponseLibrary.greetings[Math.floor(Math.random() * sarcasticResponseLibrary.greetings.length)];
            }
            if (lowerMsg.match(/\b(wie geht|wie gehts|geht es dir|gehts dir)\b/)) {
                return sarcasticResponseLibrary.compliments[Math.floor(Math.random() * sarcasticResponseLibrary.compliments.length)];
            }
            if (lowerMsg.match(/\b(was kannst|was machst|fhigkeiten|knnen)\b/)) {
                return sarcasticResponseLibrary.capabilities[Math.floor(Math.random() * sarcasticResponseLibrary.capabilities.length)];
            }
            if (lowerMsg.match(/\b(warum|wieso|weshalb|sinn|bedeutung|existenz)\b/)) {
                return sarcasticResponseLibrary.existential[Math.floor(Math.random() * sarcasticResponseLibrary.existential.length)];
            }
            if (lowerMsg.match(/\b(code|programmier|technik|funktion|algorithmus)\b/)) {
                return sarcasticResponseLibrary.technical[Math.floor(Math.random() * sarcasticResponseLibrary.technical.length)];
            }
            
            // Generic responses
            return sarcasticResponseLibrary.generic[Math.floor(Math.random() * sarcasticResponseLibrary.generic.length)];
        }

        function copyMessageText(text) {
            // Create temporary textarea
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                // Visual feedback
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = ' Kopiert!';
                btn.style.background = 'rgba(168, 213, 186, 0.4)';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 1500);
            } catch (err) {
                console.error('Copy failed:', err);
            }
            
            document.body.removeChild(textarea);
        }

        function clearChatHistory() {
            const messagesContainer = document.querySelector('.chat-messages');
            if (!messagesContainer) return;
            
            if (confirm('Mchtest du den gesamten Chat-Verlauf lschen?')) {
                messagesContainer.innerHTML = '';
            }
        }

        let selectedIcon = '';

        function showNewProjectModal() {
            selectedIcon = '';
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">Neues Projekt erstellen</div>
                    <div class="modal-content">
                        <div class="form-group">
                            <label class="form-label">Icon auswhlen</label>
                            <div class="icon-selection-grid">
                                <div class="icon-option selected" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                                <div class="icon-option" onclick="selectIcon('', event)"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Projektname</label>
                            <input type="text" class="form-input" id="project-name" placeholder="Mein Projekt">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
                        <button class="btn btn-primary" onclick="createProject()">Erstellen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function selectIcon(icon, event) {
            selectedIcon = icon;
            const options = document.querySelectorAll('.icon-option');
            options.forEach(opt => opt.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }

        function createProject() {
            const name = document.getElementById('project-name').value.trim();
            
            if (!name) {
                alert('Bitte geben Sie einen Projektnamen ein.');
                return;
            }

            const grid = document.querySelector('#projects-grid');
            if (!grid) return;

            const projectId = 'project-' + Date.now();
            const projectCard = document.createElement('div');
            projectCard.className = 'project-card';
            projectCard.onclick = () => openProjectDetails(projectId, name, selectedIcon);
            projectCard.innerHTML = `
                <div class="project-icon">${selectedIcon}</div>
                <div class="project-name">${name}</div>
            `;
            grid.appendChild(projectCard);

            // Store project data
            if (!window.allProjects) window.allProjects = {};
            window.allProjects[projectId] = {
                name: name,
                icon: selectedIcon,
                sources: []
            };

            closeModal();
        }

        function openProjectDetails(projectId, projectName, projectIcon) {
            const container = document.querySelector('#notebook-main');
            if (!container) return;

            container.innerHTML = `
                <div class="project-details">
                    <div>
                        <button class="btn-back" onclick="backToProjectList()"> Zurck zur bersicht</button>
                    </div>
                    <div class="project-details-header">
                        <div class="project-details-icon">${projectIcon}</div>
                        <div class="project-details-title">${projectName}</div>
                    </div>
                    
                    <div class="project-tabs">
                        <div class="project-tab active" data-tab="sources" onclick="switchProjectTab('${projectId}', 'sources')">
                             Quellen
                        </div>
                        <div class="project-tab" data-tab="podcast" onclick="switchProjectTab('${projectId}', 'podcast')">
                             Podcast
                        </div>
                        <div class="project-tab" data-tab="analysis" onclick="switchProjectTab('${projectId}', 'analysis')">
                             Analysen
                        </div>
                    </div>
                    
                    <div class="project-tab-content">
                        <div class="tab-pane active" data-pane="sources">
                            <div class="sources-section">
                                <div class="section-header">
                                    <div class="section-title">Quellen verwalten</div>
                                    <button class="btn-add-source" onclick="addSource('${projectId}')">+ Quelle hinzufgen</button>
                                </div>
                                <div class="sources-list" id="sources-list-${projectId}">
                                    <div class="sources-empty">Noch keine Quellen hinzugefgt</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane" data-pane="podcast">
                            <div class="output-section">
                                <div class="section-title" style="margin-bottom: 16px;">Podcast generieren</div>
                                <button class="btn-output" style="width: 100%; max-width: 400px; margin: 0 auto;" onclick="generatePodcast('${projectId}')">
                                    <div class="output-icon"></div>
                                    <div class="output-label">Podcast generieren</div>
                                </button>
                                <div id="output-result-podcast-${projectId}"></div>
                            </div>
                        </div>
                        
                        <div class="tab-pane" data-pane="analysis">
                            <div class="output-section">
                                <div class="section-title" style="margin-bottom: 16px;">Analyse erstellen</div>
                                <button class="btn-output" style="width: 100%; max-width: 400px; margin: 0 auto;" onclick="generateAnalysis('${projectId}')">
                                    <div class="output-icon"></div>
                                    <div class="output-label">Analyse generieren</div>
                                </button>
                                <div id="output-result-analysis-${projectId}"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            window.currentProjectId = projectId;
        }

        function backToProjectList() {
            const container = document.querySelector('#notebook-main');
            if (!container) return;

            container.innerHTML = `
                <div class="notebook-header">
                    <h2>Meine Projekte</h2>
                    <button class="btn-new-project" onclick="showNewProjectModal()">+ Neues Projekt</button>
                </div>
                <div class="projects-grid" id="projects-grid"></div>
            `;

            // Restore projects
            const grid = document.querySelector('#projects-grid');
            if (window.allProjects) {
                for (const [projectId, project] of Object.entries(window.allProjects)) {
                    const projectCard = document.createElement('div');
                    projectCard.className = 'project-card';
                    projectCard.onclick = () => openProjectDetails(projectId, project.name, project.icon);
                    projectCard.innerHTML = `
                        <div class="project-icon">${project.icon}</div>
                        <div class="project-name">${project.name}</div>
                    `;
                    grid.appendChild(projectCard);
                }
            }
        }

        function addSource(projectId) {
            const sourceName = prompt('Quellenname eingeben:');
            if (!sourceName || !sourceName.trim()) return;

            if (!window.allProjects[projectId].sources) {
                window.allProjects[projectId].sources = [];
            }
            window.allProjects[projectId].sources.push(sourceName.trim());

            updateSourcesList(projectId);
        }

        function updateSourcesList(projectId) {
            const sourcesList = document.querySelector(`#sources-list-${projectId}`);
            if (!sourcesList) return;

            const sources = window.allProjects[projectId].sources || [];
            
            if (sources.length === 0) {
                sourcesList.innerHTML = '<div class="sources-empty">Noch keine Quellen hinzugefgt</div>';
            } else {
                sourcesList.innerHTML = sources.map(source => `
                    <div class="source-item">
                        <div class="source-icon"></div>
                        <div class="source-name">${source}</div>
                    </div>
                `).join('');
            }
        }

        function switchProjectTab(projectId, tabName) {
            const tabs = document.querySelectorAll('.project-tab');
            const panes = document.querySelectorAll('.tab-pane');
            
            tabs.forEach(tab => {
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            panes.forEach(pane => {
                if (pane.dataset.pane === tabName) {
                    pane.classList.add('active');
                } else {
                    pane.classList.remove('active');
                }
            });
        }

        function generatePodcast(projectId) {
            const resultDiv = document.querySelector(`#output-result-podcast-${projectId}`);
            if (!resultDiv) return;

            const sources = window.allProjects[projectId].sources || [];
            const sourceCount = sources.length;

            resultDiv.innerHTML = `
                <div class="output-result">
                    <div class="podcast-player">
                        <div class="podcast-icon-large"></div>
                        <div class="podcast-title">Podcast generiert</div>
                        <div style="color: var(--color-text-secondary); font-size: var(--font-size-sm); text-align: center;">
                            Basierend auf ${sourceCount} Quelle${sourceCount !== 1 ? 'n' : ''}
                        </div>
                        <div class="podcast-controls">
                            <button class="podcast-btn"></button>
                            <button class="podcast-btn" style="width: 56px; height: 56px; font-size: 24px;"></button>
                            <button class="podcast-btn"></button>
                        </div>
                        <div style="color: var(--color-text-secondary); font-size: var(--font-size-sm); margin-top: 8px;">
                            Dauer: ~${Math.max(5, sourceCount * 3)} Minuten
                        </div>
                    </div>
                </div>
            `;
        }

        function generateAnalysis(projectId) {
            const resultDiv = document.querySelector(`#output-result-analysis-${projectId}`);
            if (!resultDiv) return;

            const sources = window.allProjects[projectId].sources || [];
            const sourceCount = sources.length;

            resultDiv.innerHTML = `
                <div class="output-result">
                    <div class="analysis-result">
                        <div class="analysis-title"> Analyse generiert</div>
                        <div class="analysis-stats">
                            <div class="stat-card">
                                <div class="stat-value">${sourceCount}</div>
                                <div class="stat-label">Quellen analysiert</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${Math.round(sourceCount * 2.5)}k</div>
                                <div class="stat-label">Wrter verarbeitet</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${Math.round(sourceCount * 15)}</div>
                                <div class="stat-label">Key Insights</div>
                            </div>
                        </div>
                        <div style="margin-top: 16px; padding: 16px; background: var(--color-background); border-radius: var(--radius-base); color: var(--color-text-secondary);">
                             Zusammenfassung erstellt<br>
                             Hauptthemen identifiziert<br>
                             Verbindungen analysiert<br>
                             Visualisierungen generiert
                        </div>
                    </div>
                </div>
            `;
        }

        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) modal.remove();
        }

        function executeCmdCommand() {
            const input = document.getElementById('cmd-input');
            const output = document.getElementById('cmd-output');
            const command = input.value.trim();
            
            if (!command) return;

            const cmdLine = document.createElement('div');
            cmdLine.className = 'terminal-line';
            cmdLine.innerHTML = `<span class="terminal-prompt">C:\\Users\\User&gt;</span> ${command}`;
            output.insertBefore(cmdLine, output.querySelector('.terminal-input-line'));

            const response = getCmdResponse(command.toLowerCase());
            const responseLine = document.createElement('div');
            responseLine.className = 'terminal-line';
            responseLine.innerHTML = response;
            responseLine.style.marginBottom = '16px';
            output.insertBefore(responseLine, output.querySelector('.terminal-input-line'));

            input.value = '';
            output.scrollTop = output.scrollHeight;
        }

        function getCmdResponse(command) {
            if (command === 'cls') {
                const output = document.getElementById('cmd-output');
                const inputLine = output.querySelector('.terminal-input-line');
                output.innerHTML = '';
                output.appendChild(inputLine);
                return '';
            }
            if (command === 'dir') {
                return `Verzeichnis von C:\\Users\\User<br><br>
                        05.11.2025  14:23    &lt;DIR&gt;          .<br>
                        05.11.2025  14:23    &lt;DIR&gt;          ..<br>
                        01.11.2025  10:15    &lt;DIR&gt;          Desktop<br>
                        15.10.2025  09:30    &lt;DIR&gt;          Documents<br>
                        20.10.2025  16:45    &lt;DIR&gt;          Downloads<br>
                        3 Datei(en), 0 Bytes<br>
                        5 Verzeichnis(se)`;
            }
            if (command.startsWith('cd ')) {
                return '';
            }
            if (command === 'help') {
                return `Verfgbare Befehle:<br>
                        DIR - Verzeichnisinhalt anzeigen<br>
                        CD - Verzeichnis wechseln<br>
                        CLS - Bildschirm lschen<br>
                        ECHO - Text ausgeben<br>
                        HELP - Hilfe anzeigen<br>
                        EXIT - Beenden<br>
                        npm install -g nodejs - Node.js installieren<br>
                        npm install -g @google/generative-ai - Gemini CLI installieren`;
            }
            if (command.startsWith('echo ')) {
                return command.substring(5);
            }
            if (command === 'npm install -g nodejs') {
                return `Installing Node.js...<br>
                         100%<br>
                        Successfully installed Node.js v20.10.0<br>
                        npm v10.2.3`;
            }
            if (command === 'npm install -g @google/generative-ai') {
                return `Installing @google/generative-ai...<br>
                         100%<br>
                        Successfully installed @google/generative-ai v0.1.0<br>
                        Gemini CLI is now available globally!`;
            }
            if (command === 'exit') {
                return 'Programm wird beendet...';
            }
            return `'${command}' ist nicht als interner oder externer Befehl,<br>ausfhrbares Programm oder Batchdatei erkannt.`;
        }

        function showCmdHelp() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal">
                    <div class="modal-header">Verfgbare Befehle</div>
                    <div class="modal-content">
                        <div class="help-command"><span class="cmd-name">dir</span> - Listet Dateien und Ordner auf</div>
                        <div class="help-command"><span class="cmd-name">cd [pfad]</span> - Wechselt das Verzeichnis</div>
                        <div class="help-command"><span class="cmd-name">cls</span> - Lscht den Bildschirm</div>
                        <div class="help-command"><span class="cmd-name">help</span> - Zeigt verfgbare Befehle</div>
                        <div class="help-command"><span class="cmd-name">echo [text]</span> - Gibt Text aus</div>
                        <div class="help-command"><span class="cmd-name">npm install -g nodejs</span> - Installiert Node.js</div>
                        <div class="help-command"><span class="cmd-name">npm install -g @google/generative-ai</span> - Installiert Gemini CLI</div>
                        <div class="help-command"><span class="cmd-name">exit</span> - Beendet die Eingabeaufforderung</div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="closeModal()">Schlieen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window) window.remove();
        }

        function centerWindow(window) {
            const desktop = document.getElementById('desktop');
            const desktopRect = desktop.getBoundingClientRect();
            const windowRect = window.getBoundingClientRect();
            
            const left = (desktopRect.width - windowRect.width) / 2 + (Math.random() * 100 - 50);
            const top = (desktopRect.height - windowRect.height) / 2 + (Math.random() * 50 - 25);
            
            window.style.left = Math.max(0, left) + 'px';
            window.style.top = Math.max(0, top) + 'px';
        }

        function bringToFront(window) {
            window.style.zIndex = ++highestZIndex;
        }

        function startDrag(event, windowId) {
            if (event.target.classList.contains('window-btn')) return;
            
            draggedWindow = document.getElementById(windowId);
            const rect = draggedWindow.getBoundingClientRect();
            
            dragOffset = {
                x: event.clientX - rect.left,
                y: event.clientY - rect.top
            };
            
            bringToFront(draggedWindow);
        }

        document.addEventListener('mousemove', (event) => {
            if (!draggedWindow) return;
            
            const desktop = document.getElementById('desktop');
            const desktopRect = desktop.getBoundingClientRect();
            
            let newX = event.clientX - dragOffset.x;
            let newY = event.clientY - dragOffset.y;
            
            newX = Math.max(0, Math.min(newX, desktopRect.width - draggedWindow.offsetWidth));
            newY = Math.max(0, Math.min(newY, desktopRect.height - draggedWindow.offsetHeight));
            
            draggedWindow.style.left = newX + 'px';
            draggedWindow.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            draggedWindow = null;
        });

        // NanoBanana image generation
        let imageCounter = 0;
        const imageColors = [
            'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
            'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
            'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
            'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
        ];

        function generateImage() {
            const promptInput = document.getElementById('nano-prompt');
            const suffixInput = document.getElementById('nano-suffix');
            const gallery = document.getElementById('nano-gallery');
            
            const prompt = promptInput.value.trim();
            const suffix = suffixInput.value.trim();
            
            if (!prompt) {
                alert('Bitte gib einen Prompt ein.');
                return;
            }

            // Remove empty message if exists
            const emptyMsg = gallery.querySelector('.gallery-empty');
            if (emptyMsg) {
                emptyMsg.remove();
            }

            // Create gallery item
            const fullPrompt = suffix ? `${prompt} ${suffix}` : prompt;
            const timestamp = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const colorIndex = imageCounter % imageColors.length;
            
            const item = document.createElement('div');
            item.className = 'gallery-item';
            item.innerHTML = `
                <div class="gallery-image" style="background: ${imageColors[colorIndex]}; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; padding: 12px; text-align: center; font-size: 11px;">
                    ${prompt.substring(0, 50)}${prompt.length > 50 ? '...' : ''}
                </div>
                <div class="gallery-timestamp">${timestamp}</div>
            `;
            
            gallery.insertBefore(item, gallery.firstChild);
            
            // Clear main prompt
            promptInput.value = '';
            imageCounter++;
            
            // Focus back to prompt input
            promptInput.focus();
        }

        // Whiteboard functionality
        let whiteboardState = {
            currentTool: 'freehand',
            currentColor: '#000000',
            canvas: null,
            ctx: null,
            isDrawing: false,
            startX: 0,
            startY: 0,
            imageData: null,
            appIconCounter: 0,
            draggedIcon: null,
            iconOffset: { x: 0, y: 0 }
        };

        function initWhiteboard(windowId) {
            const container = document.querySelector('#canvas-container');
            const canvas = document.querySelector('#whiteboard-canvas');
            if (!canvas || !container) {
                console.error('Canvas or container not found');
                return;
            }

            // Set canvas size to match container
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            whiteboardState.canvas = canvas;
            whiteboardState.ctx = canvas.getContext('2d');
            whiteboardState.ctx.lineWidth = 3;
            whiteboardState.ctx.strokeStyle = whiteboardState.currentColor;
            whiteboardState.ctx.fillStyle = whiteboardState.currentColor;
            whiteboardState.ctx.lineCap = 'round';
            whiteboardState.ctx.lineJoin = 'round';

            // Remove any existing listeners to prevent duplicates
            canvas.removeEventListener('mousedown', startWhiteboardDraw);
            canvas.removeEventListener('mousemove', whiteboardDraw);
            canvas.removeEventListener('mouseup', endWhiteboardDraw);
            canvas.removeEventListener('mouseleave', endWhiteboardDraw);
            
            // Add event listeners
            canvas.addEventListener('mousedown', startWhiteboardDraw);
            canvas.addEventListener('mousemove', whiteboardDraw);
            canvas.addEventListener('mouseup', endWhiteboardDraw);
            canvas.addEventListener('mouseleave', endWhiteboardDraw);

            console.log('Whiteboard initialized:', canvas.width, 'x', canvas.height);
        }

        function selectTool(tool) {
            whiteboardState.currentTool = tool;
            document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tool === tool) {
                    btn.classList.add('active');
                }
            });
            
            // Change cursor for text tool
            if (whiteboardState.canvas) {
                whiteboardState.canvas.style.cursor = tool === 'text' ? 'text' : 'crosshair';
            }
        }

        function toggleIconDropdown() {
            const dropdown = document.getElementById('icon-dropdown');
            if (!dropdown) return;
            
            const isVisible = dropdown.style.display !== 'none';
            dropdown.style.display = isVisible ? 'none' : 'block';
            
            if (!isVisible) {
                // Close dropdown when clicking outside
                setTimeout(() => {
                    document.addEventListener('click', closeIconDropdown);
                }, 10);
            }
        }

        function closeIconDropdown(e) {
            const dropdown = document.getElementById('icon-dropdown');
            const btn = document.getElementById('icon-dropdown-btn');
            
            if (dropdown && btn && !dropdown.contains(e.target) && !btn.contains(e.target)) {
                dropdown.style.display = 'none';
                document.removeEventListener('click', closeIconDropdown);
            }
        }

        function clearWhiteboard() {
            if (!whiteboardState.ctx || !whiteboardState.canvas) return;
            
            if (confirm('Mchtest du das gesamte Whiteboard lschen?')) {
                whiteboardState.ctx.clearRect(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
            }
        }

        function selectColor(color) {
            whiteboardState.currentColor = color;
            if (whiteboardState.ctx) {
                whiteboardState.ctx.strokeStyle = color;
                whiteboardState.ctx.fillStyle = color;
            }
            
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }

        function startWhiteboardDraw(e) {
            e.preventDefault();
            
            const rect = whiteboardState.canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;
            
            // Handle text tool
            if (whiteboardState.currentTool === 'text') {
                addTextElement(clickX, clickY);
                return;
            }
            
            whiteboardState.isDrawing = true;
            whiteboardState.startX = clickX;
            whiteboardState.startY = clickY;

            if (whiteboardState.currentTool === 'freehand') {
                whiteboardState.ctx.beginPath();
                whiteboardState.ctx.moveTo(whiteboardState.startX, whiteboardState.startY);
            } else if (whiteboardState.currentTool === 'eraser') {
                whiteboardState.ctx.globalCompositeOperation = 'destination-out';
                whiteboardState.ctx.beginPath();
                whiteboardState.ctx.moveTo(whiteboardState.startX, whiteboardState.startY);
            } else if (whiteboardState.currentTool === 'fill') {
                floodFill(whiteboardState.startX, whiteboardState.startY, whiteboardState.currentColor);
                whiteboardState.isDrawing = false;
            } else {
                // Store the current canvas state for shape tools
                whiteboardState.imageData = whiteboardState.ctx.getImageData(0, 0, whiteboardState.canvas.width, whiteboardState.canvas.height);
            }
        }

        function whiteboardDraw(e) {
            if (!whiteboardState.isDrawing) return;
            e.preventDefault();

            const rect = whiteboardState.canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;

            if (whiteboardState.currentTool === 'freehand') {
                whiteboardState.ctx.lineTo(currentX, currentY);
                whiteboardState.ctx.stroke();
            } else if (whiteboardState.currentTool === 'eraser') {
                whiteboardState.ctx.lineTo(currentX, currentY);
                whiteboardState.ctx.lineWidth = 20;
                whiteboardState.ctx.stroke();
            } else {
                // For shape tools, restore canvas and draw preview
                whiteboardState.ctx.putImageData(whiteboardState.imageData, 0, 0);
                
                const ctx = whiteboardState.ctx;
                ctx.strokeStyle = whiteboardState.currentColor;
                ctx.lineWidth = 3;
                
                if (whiteboardState.currentTool === 'circle') {
                    const radius = Math.sqrt(
                        Math.pow(currentX - whiteboardState.startX, 2) + 
                        Math.pow(currentY - whiteboardState.startY, 2)
                    );
                    ctx.beginPath();
                    ctx.arc(whiteboardState.startX, whiteboardState.startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (whiteboardState.currentTool === 'rectangle') {
                    const width = currentX - whiteboardState.startX;
                    const height = currentY - whiteboardState.startY;
                    ctx.beginPath();
                    ctx.rect(whiteboardState.startX, whiteboardState.startY, width, height);
                    ctx.stroke();
                } else if (whiteboardState.currentTool === 'arrow') {
                    drawArrow(ctx, whiteboardState.startX, whiteboardState.startY, currentX, currentY);
                }
            }
        }

        function endWhiteboardDraw(e) {
            if (!whiteboardState.isDrawing) return;
            whiteboardState.isDrawing = false;

            if (whiteboardState.currentTool === 'freehand') {
                // Freehand is already drawn, just end the path
                whiteboardState.ctx.closePath();
            } else if (whiteboardState.currentTool === 'eraser') {
                whiteboardState.ctx.closePath();
                whiteboardState.ctx.globalCompositeOperation = 'source-over';
                whiteboardState.ctx.lineWidth = 3;
            } else {
                // For shapes, the final drawing is already done in whiteboardDraw
                // Just make sure it's finalized
                const rect = whiteboardState.canvas.getBoundingClientRect();
                const endX = e.clientX - rect.left;
                const endY = e.clientY - rect.top;
                
                const ctx = whiteboardState.ctx;
                ctx.strokeStyle = whiteboardState.currentColor;
                ctx.lineWidth = 3;

                if (whiteboardState.currentTool === 'circle') {
                    const radius = Math.sqrt(
                        Math.pow(endX - whiteboardState.startX, 2) + 
                        Math.pow(endY - whiteboardState.startY, 2)
                    );
                    ctx.beginPath();
                    ctx.arc(whiteboardState.startX, whiteboardState.startY, radius, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (whiteboardState.currentTool === 'rectangle') {
                    const width = endX - whiteboardState.startX;
                    const height = endY - whiteboardState.startY;
                    ctx.beginPath();
                    ctx.rect(whiteboardState.startX, whiteboardState.startY, width, height);
                    ctx.stroke();
                } else if (whiteboardState.currentTool === 'arrow') {
                    drawArrow(ctx, whiteboardState.startX, whiteboardState.startY, endX, endY);
                }
            }
        }

        function floodFill(startX, startY, fillColor) {
            const canvas = whiteboardState.canvas;
            const ctx = whiteboardState.ctx;
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            
            startX = Math.floor(startX);
            startY = Math.floor(startY);
            
            const startPos = (startY * canvas.width + startX) * 4;
            const startR = pixels[startPos];
            const startG = pixels[startPos + 1];
            const startB = pixels[startPos + 2];
            const startA = pixels[startPos + 3];
            
            // Convert fill color to RGB
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.fillStyle = fillColor;
            tempCtx.fillRect(0, 0, 1, 1);
            const tempData = tempCtx.getImageData(0, 0, 1, 1).data;
            const fillR = tempData[0];
            const fillG = tempData[1];
            const fillB = tempData[2];
            
            // Don't fill if clicking on the same color
            if (startR === fillR && startG === fillG && startB === fillB) {
                return;
            }
            
            const pixelStack = [[startX, startY]];
            const width = canvas.width;
            const height = canvas.height;
            
            while (pixelStack.length > 0) {
                const [x, y] = pixelStack.pop();
                let currentPos = (y * width + x) * 4;
                
                while (y >= 0 && matchStartColor(pixels, currentPos, startR, startG, startB, startA)) {
                    currentPos -= width * 4;
                }
                
                currentPos += width * 4;
                let reachLeft = false;
                let reachRight = false;
                let currentY = Math.floor(currentPos / 4 / width);
                
                while (currentY < height && matchStartColor(pixels, currentPos, startR, startG, startB, startA)) {
                    pixels[currentPos] = fillR;
                    pixels[currentPos + 1] = fillG;
                    pixels[currentPos + 2] = fillB;
                    pixels[currentPos + 3] = 255;
                    
                    const currentX = Math.floor((currentPos / 4) % width);
                    
                    if (currentX > 0) {
                        if (matchStartColor(pixels, currentPos - 4, startR, startG, startB, startA)) {
                            if (!reachLeft) {
                                pixelStack.push([currentX - 1, currentY]);
                                reachLeft = true;
                            }
                        } else if (reachLeft) {
                            reachLeft = false;
                        }
                    }
                    
                    if (currentX < width - 1) {
                        if (matchStartColor(pixels, currentPos + 4, startR, startG, startB, startA)) {
                            if (!reachRight) {
                                pixelStack.push([currentX + 1, currentY]);
                                reachRight = true;
                            }
                        } else if (reachRight) {
                            reachRight = false;
                        }
                    }
                    
                    currentPos += width * 4;
                    currentY++;
                    
                    if (pixelStack.length > 50000) break; // Prevent infinite loops
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
        }
        
        function matchStartColor(pixels, pos, r, g, b, a) {
            return pixels[pos] === r && pixels[pos + 1] === g && pixels[pos + 2] === b && pixels[pos + 3] === a;
        }

        function drawArrow(ctx, fromX, fromY, toX, toY) {
            const headLength = 20;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle - Math.PI / 6),
                toY - headLength * Math.sin(angle - Math.PI / 6)
            );
            ctx.moveTo(toX, toY);
            ctx.lineTo(
                toX - headLength * Math.cos(angle + Math.PI / 6),
                toY - headLength * Math.sin(angle + Math.PI / 6)
            );
            ctx.stroke();
        }

        function addAppIcon(icon, name) {
            const container = document.querySelector('#canvas-container');
            if (!container) return;

            const iconDiv = document.createElement('div');
            iconDiv.className = 'canvas-app-icon';
            iconDiv.innerHTML = `
                <div class="canvas-app-icon-image">${icon}</div>
                <div class="canvas-app-icon-label">${name}</div>
            `;
            
            const x = 100 + (whiteboardState.appIconCounter * 30) % 400;
            const y = 100 + Math.floor(whiteboardState.appIconCounter / 10) * 100;
            iconDiv.style.left = x + 'px';
            iconDiv.style.top = y + 'px';
            
            iconDiv.addEventListener('mousedown', startIconDrag);
            container.appendChild(iconDiv);
            
            whiteboardState.appIconCounter++;
            
            // Close dropdown after selection
            const dropdown = document.getElementById('icon-dropdown');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }

        function addTextElement(x, y) {
            const container = document.querySelector('#canvas-container');
            if (!container) return;

            const textDiv = document.createElement('div');
            textDiv.className = 'canvas-text-element';
            textDiv.contentEditable = 'true';
            textDiv.style.left = x + 'px';
            textDiv.style.top = y + 'px';
            textDiv.style.color = whiteboardState.currentColor;
            textDiv.innerText = 'Text';
            
            // Event handlers
            textDiv.addEventListener('mousedown', startTextDrag);
            textDiv.addEventListener('focus', () => {
                textDiv.classList.add('editing');
            });
            textDiv.addEventListener('blur', () => {
                textDiv.classList.remove('editing');
                if (textDiv.innerText.trim() === '') {
                    textDiv.remove();
                }
            });
            
            container.appendChild(textDiv);
            
            // Focus and select text for immediate editing
            setTimeout(() => {
                textDiv.focus();
                const range = document.createRange();
                range.selectNodeContents(textDiv);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            }, 10);
        }

        let draggedText = null;
        let textDragOffset = { x: 0, y: 0 };
        let isDraggingText = false;

        function startTextDrag(e) {
            // Only drag if not editing
            if (e.target.classList.contains('editing')) return;
            
            e.stopPropagation();
            draggedText = e.currentTarget;
            isDraggingText = true;
            
            const rect = draggedText.getBoundingClientRect();
            const container = document.querySelector('#canvas-container');
            const containerRect = container.getBoundingClientRect();
            
            textDragOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            draggedText.style.zIndex = '1000';
            draggedText.style.userSelect = 'none';
        }

        document.addEventListener('mousemove', (e) => {
            if (!draggedText || !isDraggingText) return;
            
            const container = document.querySelector('#canvas-container');
            if (!container) return;
            
            const containerRect = container.getBoundingClientRect();
            let newX = e.clientX - containerRect.left - textDragOffset.x;
            let newY = e.clientY - containerRect.top - textDragOffset.y;
            
            newX = Math.max(0, Math.min(newX, containerRect.width - draggedText.offsetWidth));
            newY = Math.max(0, Math.min(newY, containerRect.height - draggedText.offsetHeight));
            
            draggedText.style.left = newX + 'px';
            draggedText.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (draggedText) {
                draggedText.style.zIndex = '';
                draggedText.style.userSelect = '';
                draggedText = null;
                isDraggingText = false;
            }
        });

        function startIconDrag(e) {
            e.stopPropagation();
            whiteboardState.draggedIcon = e.currentTarget;
            const rect = whiteboardState.draggedIcon.getBoundingClientRect();
            const container = document.querySelector('#canvas-container');
            const containerRect = container.getBoundingClientRect();
            
            whiteboardState.iconOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            whiteboardState.draggedIcon.style.zIndex = '1000';
        }

        document.addEventListener('mousemove', (e) => {
            if (!whiteboardState.draggedIcon) return;
            
            const container = document.querySelector('#canvas-container');
            if (!container) return;
            
            const containerRect = container.getBoundingClientRect();
            let newX = e.clientX - containerRect.left - whiteboardState.iconOffset.x;
            let newY = e.clientY - containerRect.top - whiteboardState.iconOffset.y;
            
            newX = Math.max(0, Math.min(newX, containerRect.width - whiteboardState.draggedIcon.offsetWidth));
            newY = Math.max(0, Math.min(newY, containerRect.height - whiteboardState.draggedIcon.offsetHeight));
            
            whiteboardState.draggedIcon.style.left = newX + 'px';
            whiteboardState.draggedIcon.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (whiteboardState.draggedIcon) {
                whiteboardState.draggedIcon.style.zIndex = '';
                whiteboardState.draggedIcon = null;
            }
        });

        // Desktop files functionality
        let desktopFiles = [
            { name: 'document.txt', icon: '', x: window.innerWidth - 120, y: window.innerHeight - 250 },
            { name: 'photo1.jpg', icon: '', x: window.innerWidth - 120, y: window.innerHeight - 170 },
            { name: 'photo2.jpg', icon: '', x: window.innerWidth - 120, y: window.innerHeight - 90 }
        ];

        let draggedFile = null;
        let fileOffset = { x: 0, y: 0 };

        function createDesktopFiles() {
            const desktop = document.getElementById('desktop');
            
            desktopFiles.forEach((file, index) => {
                const fileDiv = document.createElement('div');
                fileDiv.className = 'desktop-file';
                fileDiv.dataset.fileIndex = index;
                fileDiv.innerHTML = `
                    <div class="desktop-file-icon">${file.icon}</div>
                    <div class="desktop-file-label">${file.name}</div>
                `;
                fileDiv.style.left = file.x + 'px';
                fileDiv.style.top = file.y + 'px';
                fileDiv.style.zIndex = '900';
                
                fileDiv.addEventListener('mousedown', startFileDrag);
                desktop.appendChild(fileDiv);
            });
        }

        function startFileDrag(e) {
            e.stopPropagation();
            draggedFile = e.currentTarget;
            const rect = draggedFile.getBoundingClientRect();
            
            fileOffset = {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
            
            draggedFile.style.zIndex = '10000';
        }

        document.addEventListener('mousemove', (e) => {
            if (!draggedFile) return;
            
            const desktop = document.getElementById('desktop');
            const desktopRect = desktop.getBoundingClientRect();
            
            let newX = e.clientX - desktopRect.left - fileOffset.x;
            let newY = e.clientY - desktopRect.top - fileOffset.y;
            
            newX = Math.max(0, Math.min(newX, desktopRect.width - draggedFile.offsetWidth));
            newY = Math.max(0, Math.min(newY, desktopRect.height - draggedFile.offsetHeight));
            
            draggedFile.style.left = newX + 'px';
            draggedFile.style.top = newY + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (draggedFile) {
                draggedFile.style.zIndex = '900';
                draggedFile = null;
            }
        });

        // Update desktop icons for FOLDER and BROWSER
        function renderDesktopIcons() {
          const desktopIcons = document.querySelector('.desktop-icons');
          if (!desktopIcons) return;

          // Remove all current icons
          desktopIcons.innerHTML = '';

          // All icons with visibility check
          const icons = [
            { type: 'gemini', label: 'Gemini', icon: '', bg: 'linear-gradient(135deg, #b8d4e8 0%, #d4c4e8 100%)' },
            { type: 'aistudio', label: 'AI Studio', icon: '', bg: 'linear-gradient(135deg, #f0e5c8 0%, #e8b4d0 100%)' },
            { type: 'notebooklm', label: 'NotebookLM', icon: '', bg: 'linear-gradient(135deg, #e8b4d0 0%, #f0e5c8 100%)' },
            { type: 'vscode', label: 'Visual Studio', icon: '{ }', bg: 'linear-gradient(135deg, #d4c4e8 0%, #b8d4e8 100%)' },
            { type: 'geminicli', label: 'Gemini CLI', icon: '', bg: 'linear-gradient(135deg, #b8d4e8 0%, #a8d5ba 100%)' },
            { type: 'cmd', label: 'CMD', icon: '_', bg: 'linear-gradient(135deg, #a8d5ba 0%, #f0e5c8 100%)' },
            { type: 'nanobanana', label: 'NanoBanana', icon: '', bg: 'linear-gradient(135deg, #f0e5c8 0%, #a8d5ba 100%)' },
            { type: 'notes', label: 'Notizen', icon: '', bg: 'linear-gradient(135deg, #e8b4d0 0%, #d4c4e8 100%)' },
            { type: 'whiteboard', label: 'Whiteboard', icon: '', bg: 'linear-gradient(135deg, #d4c4e8 0%, #e8b4d0 100%)' },
            { type: 'folder', label: 'Folder', icon: '', bg: '', iconSVG: 'folder' },
            { type: 'browser', label: 'Browser', icon: '', bg: '', iconSVG: 'browser' }
          ];
          icons.forEach(cfg => {
            // Check visibility state BEFORE creating element
            if (visibilityState.apps && visibilityState.apps[cfg.type] === false) {
              return; // Skip this icon entirely
            }
            
            const d = document.createElement('div');
            d.className = 'desktop-icon';
            if (cfg.type === 'folder') d.classList.add('folder');
            if (cfg.type === 'browser') d.classList.add('browser');
            d.onclick = () => openApp(cfg.type);
            
            let iconHTML = '';
            if (cfg.iconSVG === 'folder') {
              iconHTML = `<svg width="56" height="38" viewBox="0 0 56 38" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:block;stroke:#e8b4d0;stroke-width:2;">
                <rect x="2.5" y="13" width="51" height="22" rx="6.5" fill="#fffef9" stroke="#b8d4e8" style="filter:drop-shadow(0 4px 6px #d4c4e83a)"/>
                <rect x="4.2" y="6" width="22" height="13" rx="4.5" fill="#ffe084" stroke="#a8d5ba" style="filter:drop-shadow(0 2px 4px #a8d5ba34)"/>
                <rect x="22" y="6" width="30" height="7" rx="3.5" fill="#e8b4d0" stroke="#b8d4e8"/>
                <rect x="21.1" y="9" width="16" height="3.5" rx="1.5" fill="#fff" stroke="#e8b4d0"/>
              </svg>`;
            } else if (cfg.iconSVG === 'browser') {
              iconHTML = `<svg width="56" height="56" fill="none" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg" style="display:block;stroke:#b8d4e8;stroke-width:2;">
                <circle cx="28" cy="28" r="26" fill="#fffef9" stroke="#e8b4d0"/>
                <path d="M13 43 A20 20 0 1 1 28 48 Z" fill="#a8d5ba" stroke="#a8d5ba" style="opacity:0.89;"/>
                <path d="M12 13.5 L34 24.5 L24 34" stroke="#b8d4e8" stroke-width="2.5" stroke-linecap="round"/>
                <rect x="19" y="9" width="18" height="8" rx="4" fill="#ffe084" stroke="#c1a768"/>
                <ellipse cx="28" cy="28" rx="20" ry="10" stroke="#e8b4d0" fill="#f0e5c8"/>
              </svg>`;
            } else {
              iconHTML = `<div class="icon-image" style="background: ${cfg.bg};">${cfg.icon}</div>`;
            }
            d.innerHTML = iconHTML ?
              `<div class="icon-image">${iconHTML}</div>
              <div class="icon-label">${cfg.label}</div>` :
              `<div class="icon-image">${cfg.icon}</div><div class="icon-label">${cfg.label}</div>`;
            desktopIcons.appendChild(d);
          });
        }
        
        window.addEventListener('DOMContentLoaded', function() {
          renderDesktopIcons();
          renderDesktopFiles();
        });
        
        // --- FOLDER APP ---
        function openApp(appType) {
          if (appType === 'folder') {
            openFolderWindow();
            return;
          }
          if (appType === 'browser') {
            openBrowserWindow();
            return;
          }
          // Default/legacy:
          const windowId = `window-${++windowCounter}`;
          const windowDiv = createWindow(windowId, appType);
          document.getElementById('desktop').appendChild(windowDiv);
          centerWindow(windowDiv);
          bringToFront(windowDiv);
        }

        function openFolderWindow() {
          const windowId = `folderwindow-${++windowCounter}`;
          // Clone template
          const t = document.getElementById('folder-window-template');
          const content = t.innerHTML.replace(/#FOLDER_ID#/g, windowId);
          const win = document.createElement('div');
          win.innerHTML = content;
          const windowEl = win.firstElementChild;
          windowEl.id = windowId;
          desktop.appendChild(windowEl);
          centerWindow(windowEl);
          bringToFront(windowEl);

          // Tab logic
          const tabs = windowEl.querySelectorAll('.folder-tab'),
                gridEls = windowEl.querySelectorAll('.folder-tools-grid');
          tabs.forEach(tab => tab.onclick = function() {
            tabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            gridEls.forEach(e => {
              e.classList.toggle('hidden', e.getAttribute('data-content') !== this.dataset.tab);
            });
          });

          // Populate tool grids
          Object.keys(folderTools).forEach(tab => {
            const grid = windowEl.querySelector(`.folder-tools-grid[data-content='${tab}']`);
            if (!grid) return;
            folderTools[tab].forEach((tool, i) => {
              const toolBtn = document.createElement('button');
              toolBtn.className = 'folder-tool-btn';
              toolBtn.style.borderColor = tool.color || '#b8d4e8';
              toolBtn.title = tool.name;
              toolBtn.onclick = function() { showFolderToolPopup(tool.name, tool.icon, tab); };
              toolBtn.innerHTML = `<div class='folder-tool-icon' style='background:${tool.color};'>${tool.icon}</div><div class='folder-tool-label'>${tool.name}</div>`;
              grid.appendChild(toolBtn);
            });
          });
        }

        function showFolderToolPopup(name, icon, cat) {
          const details = toolDetails[name];
          if (!details) {
            alert('Keine Details verfgbar fr: ' + name);
            return;
          }
          
          const modal = document.createElement('div');
          modal.className = 'modal-overlay';
          modal.innerHTML = `<div class="tool-detail-modal">
            <div class="tool-detail-header">
              <div class="tool-detail-icon">${icon}</div>
              <div class="tool-detail-title">${name}</div>
            </div>
            <div class="tool-detail-desc">${details.desc}</div>
            <a href="${details.url}" target="_blank" rel="noopener noreferrer" class="tool-detail-link">
               Website besuchen
            </a>
            <button class="btn btn-secondary" onclick="closeModal()" style="margin-left: 12px;">Schlieen</button>
          </div>`;
          document.body.appendChild(modal);
        }

        // --- BROWSER APP ---
        function openBrowserWindow() {
          const windowId = `browserwindow-${++windowCounter}`;
          const t = document.getElementById('browser-window-template');
          const content = t.innerHTML.replace(/#BROWSER_ID#/g, windowId);
          const win = document.createElement('div');
          win.innerHTML = content;
          const windowEl = win.firstElementChild;
          windowEl.id = windowId;
          desktop.appendChild(windowEl);
          centerWindow(windowEl);
          bringToFront(windowEl);
          setupBrowserApp(windowEl, windowId);
        }

        function setupBrowserApp(win, windowId) {
          const urlInput = win.querySelector(`#${windowId}-url`),
                backBtn = win.querySelector(`#${windowId}-back`),
                fwdBtn = win.querySelector(`#${windowId}-forward`),
                refreshBtn = win.querySelector(`#${windowId}-refresh`),
                goBtn = win.querySelector(`#${windowId}-go`),
                iframe = win.querySelector(`#${windowId}-iframe`),
                favs = win.querySelector(`#${windowId}-favorites`); 

          // Browser Nav State
          const navState = { history: [], index: -1 };

          // Home links/favorites
          const favorites = [
            { name: 'Google', url: 'https://www.google.com/', icon: '' },
            { name: 'Wikipedia', url: 'https://de.wikipedia.org/', icon: '' },
            { name: 'GitHub', url: 'https://github.com/', icon: '' },
            { name: 'YouTube', url: 'https://www.youtube.com/', icon: '' },
            { name: 'OpenAI', url: 'https://platform.openai.com/', icon: '' },
            { name: 'Hugging Face', url: 'https://huggingface.co/', icon: '' }
          ];
          favs.innerHTML = favorites.map(f => `<button class='browser-fav-btn' data-url='${f.url}' title='${f.name}'>${f.icon} ${f.name}</button>`).join('');
          favs.querySelectorAll('.browser-fav-btn').forEach(btn => btn.onclick = () => {
            browserGo(win, windowId, btn.getAttribute('data-url'), navState);
          });

          // Show home page initially
          iframe.srcdoc = browserWelcomeHTML;
          urlInput.value = '';
          
          function syncNavBtns() {
            backBtn.disabled = navState.index <= 0;
            fwdBtn.disabled = navState.index >= navState.history.length - 1 || navState.index === -1;
          }

          function browserGo(win, windowId, url, navState, newStep = true) {
            url = url.trim();
            if (!/^https?:\/\//i.test(url) && !/^\//.test(url)) {
              url = 'https://' + url;
            }
            iframe.src = url;
            urlInput.value = url;
            if (newStep) {
              navState.history.splice(navState.index + 1);
              navState.history.push(url);
              navState.index = navState.history.length - 1;
            }
            syncNavBtns();
          }
          backBtn.onclick = function() {
            if (navState.index > 0) {
              navState.index--;
              urlInput.value = navState.history[navState.index];
              iframe.src = navState.history[navState.index];
              syncNavBtns();
            }
          };
          fwdBtn.onclick = function() {
            if (navState.index < navState.history.length - 1) {
              navState.index++;
              urlInput.value = navState.history[navState.index];
              iframe.src = navState.history[navState.index];
              syncNavBtns();
            }
          };
          refreshBtn.onclick = function() {
            if (navState.index !== -1) {
              iframe.src = navState.history[navState.index];
            } else {
              iframe.srcdoc = browserWelcomeHTML;
            }
          };
          goBtn.onclick = () => browserGo(win, windowId, urlInput.value, navState);
          urlInput.onkeypress = function(e) { if (e.key === 'Enter') browserGo(win, windowId, urlInput.value, navState); };
          urlInput.onfocus = function() { urlInput.select(); };
          syncNavBtns();
        }

        // Override desktop file creation to support both old and new icons
        // ... existing desktopFiles remains ...

        // Settings Modal Functionality
        function openSettingsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal" style="max-width: 600px;">
                    <div class="modal-header">Einstellungen</div>
                    <div class="modal-content settings-modal-content">
                        <div class="settings-section">
                            <div class="settings-section-title">Apps anzeigen/ausblenden</div>
                            ${['gemini', 'aistudio', 'notebooklm', 'vscode', 'geminicli', 'cmd', 'nanobanana', 'notes', 'whiteboard', 'folder', 'browser'].map(app => `
                                <div class="settings-checkbox-item">
                                    <input type="checkbox" class="settings-checkbox" id="toggle-${app}" data-type="app" data-name="${app}" checked>
                                    <label class="settings-checkbox-label" for="toggle-${app}">${getAppDisplayName(app)}</label>
                                </div>
                            `).join('')}
                        </div>
                        <div class="settings-section">
                            <div class="settings-section-title">Desktop-Dateien anzeigen/ausblenden</div>
                            <div class="settings-checkbox-item">
                                <input type="checkbox" class="settings-checkbox" id="toggle-file-0" data-type="file" data-index="0" checked>
                                <label class="settings-checkbox-label" for="toggle-file-0">document.txt</label>
                            </div>
                            <div class="settings-checkbox-item">
                                <input type="checkbox" class="settings-checkbox" id="toggle-file-1" data-type="file" data-index="1" checked>
                                <label class="settings-checkbox-label" for="toggle-file-1">photo1.jpg</label>
                            </div>
                            <div class="settings-checkbox-item">
                                <input type="checkbox" class="settings-checkbox" id="toggle-file-2" data-type="file" data-index="2" checked>
                                <label class="settings-checkbox-label" for="toggle-file-2">photo2.jpg</label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="closeModal()">Schlieen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Add change listeners
            modal.querySelectorAll('.settings-checkbox').forEach(cb => {
                cb.addEventListener('change', handleSettingsToggle);
            });
        }

        function getAppDisplayName(app) {
            const names = {
                gemini: 'Gemini',
                aistudio: 'AI Studio',
                notebooklm: 'NotebookLM',
                vscode: 'Visual Studio',
                geminicli: 'Gemini CLI',
                cmd: 'CMD',
                nanobanana: 'NanoBanana',
                notes: 'Notizen',
                whiteboard: 'Whiteboard',
                folder: 'Folder',
                browser: 'Browser'
            };
            return names[app] || app;
        }

        // State management for visibility
        const visibilityState = {
            apps: {
                gemini: true,
                aistudio: true,
                notebooklm: true,
                vscode: true,
                geminicli: true,
                cmd: true,
                nanobanana: true,
                notes: true,
                whiteboard: true,
                folder: true,
                browser: true
            },
            files: [true, true, true]
        };

        function handleSettingsToggle(e) {
            const checkbox = e.target;
            const type = checkbox.dataset.type;
            const isVisible = checkbox.checked;

            if (type === 'app') {
                const appName = checkbox.dataset.name;
                visibilityState.apps[appName] = isVisible;
                
                // Re-render desktop icons with updated visibility
                renderDesktopIcons();
            } else if (type === 'file') {
                const fileIndex = parseInt(checkbox.dataset.index);
                visibilityState.files[fileIndex] = isVisible;
                
                // Re-render desktop files with updated visibility
                renderDesktopFiles();
            }
        }

        // Notes App Functionality - SIMPLIFIED
        function initNotesApp(windowId) {
            const editor = document.getElementById('notes-editor');
            if (!editor) return;

            // Auto-save on input
            editor.addEventListener('input', () => {
                if (window.currentNoteId && window.allNotes) {
                    const noteData = window.allNotes[window.currentNoteId];
                    noteData.content = editor.innerHTML;
                    noteData.modified = new Date().toISOString();
                    
                    // Update sidebar preview
                    const noteItem = document.querySelector(`[data-note-id="${window.currentNoteId}"]`);
                    if (noteItem) {
                        const text = editor.innerText || '';
                        const title = text.split('\n')[0].substring(0, 20) || 'Neue Notiz';
                        const preview = text.substring(0, 50) + (text.length > 50 ? '...' : '');
                        noteItem.querySelector('.note-item-title').textContent = title;
                        noteItem.querySelector('.note-item-preview').textContent = preview || 'Leere Notiz';
                    }
                }
            });
        }

        function createNewNote() {
            const editor = document.getElementById('notes-editor');
            const notesList = document.getElementById('notes-list');
            
            if (!editor) return;

            // Remove active from all notes
            notesList.querySelectorAll('.note-item').forEach(n => n.classList.remove('active'));

            const now = new Date();
            const noteId = 'note-' + now.getTime();
            
            // Create note item in sidebar
            const emptyMsg = notesList.querySelector('.notes-empty-sidebar');
            if (emptyMsg) emptyMsg.remove();

            const noteItem = document.createElement('div');
            noteItem.className = 'note-item active';
            noteItem.dataset.noteId = noteId;
            noteItem.innerHTML = `
                <div class="note-item-title">Neue Notiz</div>
                <div class="note-item-preview">${now.toLocaleString('de-DE', { hour: '2-digit', minute: '2-digit' })}</div>
            `;
            noteItem.onclick = () => loadNote(noteId);
            notesList.insertBefore(noteItem, notesList.firstChild);

            // Clear editor
            editor.innerHTML = '';
            editor.focus();

            // Store note data
            const noteData = {
                id: noteId,
                created: now.toISOString(),
                modified: now.toISOString(),
                content: ''
            };
            
            if (!window.allNotes) window.allNotes = {};
            window.allNotes[noteId] = noteData;
            window.currentNoteId = noteId;
        }

        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('notes-editor').focus();
        }

        function changeFontSize(size) {
            const editor = document.getElementById('notes-editor');
            if (editor) editor.style.fontSize = size;
        }

        function changeTextColor(color) {
            document.execCommand('foreColor', false, color);
            document.getElementById('notes-editor').focus();
        }

        function changeHighlight(color) {
            document.execCommand('backColor', false, color);
            document.getElementById('notes-editor').focus();
        }

        function setNoteTheme(color) {
            const editor = document.getElementById('notes-editor');
            if (editor) {
                editor.style.background = color;
                if (window.currentNoteId && window.allNotes) {
                    window.allNotes[window.currentNoteId].theme = color;
                }
            }
        }

        function saveCurrentNote() {
            const editor = document.getElementById('notes-editor');
            const tagsInput = document.getElementById('notes-tags');
            
            if (!editor || !window.currentNoteId || !window.allNotes) return;

            const noteData = window.allNotes[window.currentNoteId];
            noteData.content = editor.innerHTML;
            noteData.tags = tagsInput.value;
            noteData.modified = new Date().toISOString();

            // Update sidebar preview
            const noteItem = document.querySelector(`[data-note-id="${window.currentNoteId}"]`);
            if (noteItem) {
                const text = editor.innerText || '';
                const preview = text.substring(0, 30) + (text.length > 30 ? '...' : '');
                noteItem.querySelector('.note-item-preview').textContent = preview || 'Leere Notiz';
            }

            alert('Notiz gespeichert!');
        }

        function exportNoteTxt() {
            const editor = document.getElementById('notes-editor');
            if (!editor) return;

            const text = editor.innerText;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'notiz.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportNotePng() {
            alert('PNG-Export wrde hier das Notizen-Fenster als Bild speichern.');
        }

        function copyAllNote() {
            const editor = document.getElementById('notes-editor');
            if (!editor) return;

            const text = editor.innerText;
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            
            try {
                document.execCommand('copy');
                alert('Text kopiert!');
            } catch (err) {
                console.error('Copy failed:', err);
            }
            
            document.body.removeChild(textarea);
        }

        function clearNote() {
            const editor = document.getElementById('notes-editor');
            if (!editor) return;

            if (confirm('Mchtest du die aktuelle Notiz wirklich lschen?')) {
                editor.innerHTML = '';
                document.getElementById('notes-tags').value = '';
                document.getElementById('word-count').textContent = 'Wrter: 0';
                document.getElementById('char-count').textContent = 'Zeichen: 0';
            }
        }

        function loadNote(noteId) {
            const notesList = document.querySelectorAll('.note-item');
            notesList.forEach(item => item.classList.remove('active'));
            const noteItem = document.querySelector(`[data-note-id="${noteId}"]`);
            if (noteItem) noteItem.classList.add('active');

            // Load note content
            if (window.allNotes && window.allNotes[noteId]) {
                const editor = document.getElementById('notes-editor');
                if (editor) {
                    editor.innerHTML = window.allNotes[noteId].content;
                    window.currentNoteId = noteId;
                }
            }
        }

        function deleteCurrentNote() {
            if (!window.currentNoteId) {
                alert('Keine Notiz ausgewhlt.');
                return;
            }

            if (!confirm('Mchtest du diese Notiz wirklich lschen?')) return;

            // Remove from data
            if (window.allNotes) {
                delete window.allNotes[window.currentNoteId];
            }

            // Remove from sidebar
            const noteItem = document.querySelector(`[data-note-id="${window.currentNoteId}"]`);
            if (noteItem) noteItem.remove();

            // Clear editor
            const editor = document.getElementById('notes-editor');
            if (editor) editor.innerHTML = '';

            window.currentNoteId = null;

            // Check if no notes left
            const notesList = document.getElementById('notes-list');
            if (notesList && notesList.querySelectorAll('.note-item').length === 0) {
                notesList.innerHTML = '<div class="notes-empty-sidebar">Keine Notizen</div>';
            }
        }

        // Visual Studio Functionality
        function toggleFolder(folderEl) {
            const content = folderEl.querySelector('.folder-content');
            if (content) {
                content.style.display = content.style.display === 'none' ? 'block' : 'none';
            }
        }

        function openVSFile(fileName) {
            console.log('Opening file:', fileName);
        }

        function switchVSTab(fileName) {
            const tabs = document.querySelectorAll('.vscode-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.currentTarget.classList.add('active');

            // Show corresponding code
            const codeContents = document.querySelectorAll('.code-content');
            codeContents.forEach(content => content.classList.add('hidden'));
            
            if (fileName === 'GeminiIntegration.cs') {
                document.getElementById('code-gemini')?.classList.remove('hidden');
            } else if (fileName === 'AIModelConfig.cs') {
                document.getElementById('code-config')?.classList.remove('hidden');
            } else if (fileName === 'Program.cs') {
                document.getElementById('code-program')?.classList.remove('hidden');
            }
        }

        function insertCodeSnippet(type) {
            alert(`Code-Snippet "${type}" wrde hier eingefgt.`);
        }

        function changeVSTheme(theme) {
            const container = document.querySelector('.vscode-container');
            if (theme === 'light') {
                container.style.background = '#f5f5f5';
                alert('Light Theme aktiviert');
            } else {
                container.style.background = '#1e1e1e';
                alert('Dark Theme aktiviert');
            }
        }

        // Render desktop files with visibility check
        function renderDesktopFiles() {
            const desktop = document.getElementById('desktop');
            // Remove existing files
            desktop.querySelectorAll('.desktop-file').forEach(f => f.remove());
            
            desktopFiles.forEach((file, index) => {
                // Check visibility state BEFORE creating element
                if (visibilityState.files && visibilityState.files[index] === false) {
                    return; // Skip this file entirely
                }
                
                const fileDiv = document.createElement('div');
                fileDiv.className = 'desktop-file';
                fileDiv.dataset.fileIndex = index;
                fileDiv.innerHTML = `
                    <div class="desktop-file-icon">${file.icon}</div>
                    <div class="desktop-file-label">${file.name}</div>
                `;
                fileDiv.style.left = file.x + 'px';
                fileDiv.style.top = file.y + 'px';
                fileDiv.style.zIndex = '900';
                
                fileDiv.addEventListener('mousedown', startFileDrag);
                desktop.appendChild(fileDiv);
            });
        }
    </script>
</body>
</html>